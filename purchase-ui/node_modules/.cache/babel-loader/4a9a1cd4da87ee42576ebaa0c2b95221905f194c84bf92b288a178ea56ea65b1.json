{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport { useCallback, useEffect } from \"react\";\nimport { getElementSize } from \"../useComponentSize\";\nimport { useMutableRef } from \"../useMutableRef\";\nexport var defaultItemsCalculationCount = 5;\nexport var arraysIsEq = function (a, b) {\n  return a.join(\"-\") === b.join(\"-\");\n};\nexport var useScroll = function (a, b, c) {\n  useEffect(function () {\n    if (c) {\n      var d;\n      null === (d = a.current) || void 0 === d ? void 0 : d.addEventListener(\"scroll\", b);\n    }\n    return function () {\n      var c;\n      null === (c = a.current) || void 0 === c ? void 0 : c.removeEventListener(\"scroll\", b);\n    };\n  }, [a.current, b, c]);\n};\nexport var getElementHeight = function (a) {\n  return getElementSize(a).height;\n};\nvar roundPositionByGap = function (a, b) {\n  return 0 >= a ? 0 : Math.ceil(a / b) * b;\n};\nexport var getVisiblePosition = function (a, b, c) {\n  var d = b > c * defaultItemsCalculationCount ? 1.5 * b : c * defaultItemsCalculationCount,\n    e = [Math.ceil(roundPositionByGap(a - d, b)), Math.ceil(roundPositionByGap(0 === a ? d : a + d, b))];\n  return e;\n};\nexport var calculateSavedSizes = function (a, b) {\n  for (var c, d = _toConsumableArray(a), e = 0; e < b.length; e++) c = b[e], 0 < c && (d[e] = c);\n  return d;\n};\nexport var useCalculateVisiblePosition = function (a, b, c) {\n  var d = useMutableRef(Math.max.apply(null, c));\n  return useCallback(function () {\n    if (a) {\n      var c = getVisiblePosition(a.scrollTop, getElementHeight(a), d.current);\n      b(function (a) {\n        return c[0] !== a[0] || c[1] !== a[1] ? c : a;\n      });\n    }\n  }, [a, b]);\n};\nvar addCount = function (a, b, c) {\n  for (var d = c.slice(-50), e = d.reduce(function (c, a) {\n      return c + a;\n    }, 0) / d.length, f = defaultItemsCalculationCount; b[1] >= a[1] + f * e;) f += defaultItemsCalculationCount;\n  return f;\n};\nexport var calculateBounds = function (a, b, c, d) {\n  for (var e = [0, 0], f = [0, 0], g = 0; g < a.length; g++) c[0] > e[0] && (e[0] += a[g], f[0] = g + 1), c[1] > e[1] && (e[1] += a[g], f[1] = g + 1);\n  return 0 === f[0] && 0 === f[1] && (f[1] = defaultItemsCalculationCount), b.length !== a.length && (f[1] += addCount(e, c, a)), f[1] > d && (f[1] = d), [e, f];\n};","map":{"version":3,"names":["useCallback","useEffect","getElementSize","useMutableRef","defaultItemsCalculationCount","arraysIsEq","a","b","join","useScroll","c","d","current","addEventListener","removeEventListener","getElementHeight","height","roundPositionByGap","Math","ceil","getVisiblePosition","e","calculateSavedSizes","_toConsumableArray","length","useCalculateVisiblePosition","max","apply","scrollTop","addCount","slice","reduce","f","calculateBounds","g"],"sources":["/Users/leonofv/Documents/GitHub/PurchasesProject/purchase-ui/node_modules/@consta/src/hooks/useVirtualScroll/hellpers.ts"],"sourcesContent":["import { RefObject, useCallback, useEffect } from 'react';\n\nimport { getElementSize } from '##/hooks/useComponentSize';\nimport { useMutableRef } from '##/hooks/useMutableRef';\n\nexport type UseVirtualScrollProps = {\n  length: number;\n  isActive?: boolean;\n  onScrollToBottom?: (index: number) => void;\n};\n\nexport type UseVirtualScrollReturn<ITEM_ELEMENT, SCROLL_ELEMENT> = {\n  listRefs: React.RefObject<ITEM_ELEMENT>[];\n  scrollElementRef: React.RefObject<SCROLL_ELEMENT>;\n  slice: [number, number];\n  spaceTop: number;\n};\n\nexport type Bounds = [[number, number], [number, number]];\n\nexport const defaultItemsCalculationCount = 5;\n\nexport const arraysIsEq = (arr1: number[], arr2: number[]) =>\n  arr1.join('-') === arr2.join('-');\n\nexport const useScroll = (\n  ref: RefObject<HTMLElement>,\n  fn: () => void,\n  isActive: boolean,\n) => {\n  useEffect(() => {\n    if (isActive) {\n      ref.current?.addEventListener('scroll', fn);\n    }\n\n    return () => {\n      ref.current?.removeEventListener('scroll', fn);\n    };\n  }, [ref.current, fn, isActive]);\n};\n\nexport const getElementHeight = (el: HTMLElement | SVGGraphicsElement | null) =>\n  getElementSize(el).height;\n\nconst roundPositionByGap = (position: number, gap: number) => {\n  if (position <= 0) {\n    return 0;\n  }\n  return Math.ceil(position / gap) * gap;\n};\n\nexport const getVisiblePosition = (\n  top: number,\n  height: number,\n  elementMaxSize: number,\n): [number, number] => {\n  const gap =\n    height > elementMaxSize * defaultItemsCalculationCount\n      ? height * 1.5\n      : elementMaxSize * defaultItemsCalculationCount;\n\n  const visiblePosition: [number, number] = [\n    Math.ceil(roundPositionByGap(top - gap, height)),\n    Math.ceil(roundPositionByGap(top === 0 ? gap : top + gap, height)),\n  ];\n\n  return visiblePosition;\n};\n\nexport const calculateSavedSizes = (savedSizes: number[], sizes: number[]) => {\n  const newSavedSizes = [...savedSizes];\n  for (let index = 0; index < sizes.length; index++) {\n    const element = sizes[index];\n    if (element > 0) {\n      newSavedSizes[index] = element;\n    }\n  }\n  return newSavedSizes;\n};\n\nexport const useCalculateVisiblePosition = (\n  scrollElement: HTMLElement | null,\n  set: (value: React.SetStateAction<[number, number]>) => void,\n  elementsSizes: number[],\n) => {\n  const elementMaxSizeRef = useMutableRef(Math.max.apply(null, elementsSizes));\n\n  return useCallback(() => {\n    if (!scrollElement) {\n      return;\n    }\n\n    const visiblePosition = getVisiblePosition(\n      scrollElement.scrollTop,\n      getElementHeight(scrollElement),\n      elementMaxSizeRef.current,\n    );\n\n    set((state) => {\n      if (visiblePosition[0] !== state[0] || visiblePosition[1] !== state[1]) {\n        return visiblePosition;\n      }\n\n      return state;\n    });\n  }, [scrollElement, set]);\n};\n\nconst addCount = (\n  pxs: [number, number],\n  visiblePosition: [number, number],\n  savedSize: number[],\n) => {\n  const lastSavedSize = savedSize.slice(-50);\n  const average =\n    lastSavedSize.reduce((a, b) => a + b, 0) / lastSavedSize.length;\n\n  let add = defaultItemsCalculationCount;\n\n  while (visiblePosition[1] >= pxs[1] + add * average) {\n    add += defaultItemsCalculationCount;\n  }\n\n  return add;\n};\n\nexport const calculateBounds = (\n  savedSizes: number[],\n  sizes: number[],\n  visiblePosition: [number, number],\n  length: number,\n): Bounds => {\n  const pxs: [number, number] = [0, 0];\n  const indexs: [number, number] = [0, 0];\n\n  for (let index = 0; index < savedSizes.length; index++) {\n    if (visiblePosition[0] > pxs[0]) {\n      pxs[0] += savedSizes[index];\n      indexs[0] = index + 1;\n    }\n\n    if (visiblePosition[1] > pxs[1]) {\n      pxs[1] += savedSizes[index];\n      indexs[1] = index + 1;\n    }\n  }\n\n  if (indexs[0] === 0 && indexs[1] === 0) {\n    indexs[1] = defaultItemsCalculationCount;\n  }\n\n  if (sizes.length !== savedSizes.length) {\n    indexs[1] += addCount(pxs, visiblePosition, savedSizes);\n  }\n\n  if (indexs[1] > length) {\n    indexs[1] = length;\n  }\n\n  return [pxs, indexs];\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}