{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport { useMutableRef } from \"../useMutableRef\";\nimport { useRefs } from \"../useRefs\";\nimport { useResizeObserved } from \"../useResizeObserved\";\nimport { arraysIsEq, calculateBounds, calculateSavedSizes, defaultItemsCalculationCount, getElementHeight, useCalculateVisiblePosition, useScroll } from \"./hellpers\";\nexport var useVirtualScroll = function (a) {\n  var b = a.length,\n    c = a.onScrollToBottom,\n    d = a.isActive,\n    e = void 0 !== d && d,\n    f = useState([0, 0]),\n    g = _slicedToArray(f, 2),\n    h = g[0],\n    i = g[1],\n    j = useState([[0, 0], [0, e ? defaultItemsCalculationCount : b]]),\n    k = _slicedToArray(j, 2),\n    l = k[0],\n    m = k[1],\n    n = useRefs(b, h),\n    o = useRef(null),\n    p = useResizeObserved(n, getElementHeight),\n    q = useRef(calculateSavedSizes([], p)),\n    r = useMutableRef(c),\n    s = useResizeObserved(useMemo(function () {\n      return [o];\n    }, [o]), getElementHeight),\n    t = _slicedToArray(s, 1),\n    u = t[0],\n    v = useCalculateVisiblePosition(o.current, i, p);\n  return useScroll(o, v, e), useEffect(function () {\n    e && v();\n  }, [u, e]), useEffect(function () {\n    e ? (q.current = calculateSavedSizes(q.current, p), m(calculateBounds(q.current, p, h, b))) : m([[0, 0], [0, b]]);\n  }, [].concat(_toConsumableArray(h), [p, b, e])), useEffect(function () {\n    e && r.current && l[1][1] + 1 >= b && r.current(b);\n  }, [l[1][1], e]), useEffect(function () {\n    var a = [0, 0],\n      c = [[0, 0], [0, e ? defaultItemsCalculationCount : b]];\n    m(function (a) {\n      return arraysIsEq(a[0], c[0]) && arraysIsEq(a[1], c[1]) ? a : c;\n    }), i(function (b) {\n      return arraysIsEq(b, a) ? b : a;\n    });\n  }, [e]), {\n    listRefs: n,\n    scrollElementRef: o,\n    slice: l[1],\n    spaceTop: l[0][0]\n  };\n};","map":{"version":3,"names":["useEffect","useMemo","useRef","useState","useMutableRef","useRefs","useResizeObserved","arraysIsEq","calculateBounds","calculateSavedSizes","defaultItemsCalculationCount","getElementHeight","useCalculateVisiblePosition","useScroll","useVirtualScroll","a","b","length","c","onScrollToBottom","d","isActive","e","f","g","_slicedToArray","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","current","concat","_toConsumableArray","listRefs","scrollElementRef","slice","spaceTop"],"sources":["/Users/leonofv/Documents/GitHub/PurchasesProject/purchase-ui/node_modules/@consta/src/hooks/useVirtualScroll/useVirtualScroll.ts"],"sourcesContent":["import { useEffect, useMemo, useRef, useState } from 'react';\n\nimport { useMutableRef } from '##/hooks/useMutableRef';\nimport { useRefs } from '##/hooks/useRefs';\nimport { useResizeObserved } from '##/hooks/useResizeObserved';\n\nimport {\n  arraysIsEq,\n  Bounds,\n  calculateBounds,\n  calculateSavedSizes,\n  defaultItemsCalculationCount,\n  getElementHeight,\n  useCalculateVisiblePosition,\n  useScroll,\n  UseVirtualScrollProps,\n  UseVirtualScrollReturn,\n} from './hellpers';\n\nexport const useVirtualScroll = <\n  ITEM_ELEMENT extends HTMLElement = HTMLDivElement,\n  SCROLL_ELEMENT extends HTMLElement = HTMLDivElement,\n>({\n  length,\n  onScrollToBottom,\n  isActive = false,\n}: UseVirtualScrollProps): UseVirtualScrollReturn<\n  ITEM_ELEMENT,\n  SCROLL_ELEMENT\n> => {\n  const [visiblePosition, setVisiblePosition] = useState<[number, number]>([\n    0, 0,\n  ]);\n  const [bounds, setBounds] = useState<Bounds>([\n    [0, 0],\n    [0, isActive ? defaultItemsCalculationCount : length],\n  ]);\n  const listRefs = useRefs<ITEM_ELEMENT>(length, visiblePosition);\n  const scrollElementRef = useRef<SCROLL_ELEMENT>(null);\n  const sizes = useResizeObserved(listRefs, getElementHeight);\n  const savedSizesRef = useRef(calculateSavedSizes([], sizes));\n  const onScrollToBottomRef = useMutableRef(onScrollToBottom);\n  const [scrollElementRefHeight] = useResizeObserved(\n    useMemo(() => {\n      return [scrollElementRef];\n    }, [scrollElementRef]),\n    getElementHeight,\n  );\n  const calculateVisiblePosition = useCalculateVisiblePosition(\n    scrollElementRef.current,\n    setVisiblePosition,\n    sizes,\n  );\n\n  useScroll(scrollElementRef, calculateVisiblePosition, isActive);\n\n  useEffect(() => {\n    if (isActive) {\n      calculateVisiblePosition();\n    }\n  }, [scrollElementRefHeight, isActive]);\n\n  useEffect(() => {\n    if (isActive) {\n      savedSizesRef.current = calculateSavedSizes(savedSizesRef.current, sizes);\n      setBounds(\n        calculateBounds(savedSizesRef.current, sizes, visiblePosition, length),\n      );\n    } else {\n      setBounds([\n        [0, 0],\n        [0, length],\n      ]);\n    }\n  }, [...visiblePosition, sizes, length, isActive]);\n\n  useEffect(() => {\n    if (isActive && onScrollToBottomRef.current && bounds[1][1] + 1 >= length) {\n      onScrollToBottomRef.current(length);\n    }\n  }, [bounds[1][1], isActive]);\n\n  useEffect(() => {\n    const resetVisiblePosition: [number, number] = [0, 0];\n    const resetBounds: Bounds = [\n      [0, 0],\n      [0, isActive ? defaultItemsCalculationCount : length],\n    ];\n\n    setBounds((state) =>\n      arraysIsEq(state[0], resetBounds[0]) &&\n      arraysIsEq(state[1], resetBounds[1])\n        ? state\n        : resetBounds,\n    );\n\n    setVisiblePosition((state) =>\n      arraysIsEq(state, resetVisiblePosition) ? state : resetVisiblePosition,\n    );\n  }, [isActive]);\n\n  return {\n    listRefs,\n    scrollElementRef,\n    slice: bounds[1],\n    spaceTop: bounds[0][0],\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}