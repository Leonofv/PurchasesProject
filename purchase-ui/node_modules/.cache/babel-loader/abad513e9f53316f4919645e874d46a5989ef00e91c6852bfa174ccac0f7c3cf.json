{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport { useEffect, useLayoutEffect, useRef, useState } from \"react\";\nimport { usePrevious } from \"../../hooks/usePrevious\";\nimport { useRefs } from \"../../hooks/useRefs\";\nimport { animateTimeout } from \"../../mixs/MixPopoverAnimate\";\nexport var useMenuNavigation = function (a) {\n  var b = a.items,\n    c = a.addLevel,\n    d = a.deleteLevel,\n    e = a.active,\n    f = a.getItemSubMenu,\n    g = a.level,\n    h = void 0 === g ? 0 : g,\n    i = a.onEsc,\n    j = a.isMobile,\n    k = useState(-1),\n    l = _slicedToArray(k, 2),\n    m = l[0],\n    n = l[1],\n    o = useState(),\n    p = _slicedToArray(o, 2),\n    q = p[0],\n    r = p[1],\n    s = useRefs(b.length),\n    t = useRef(null),\n    u = useRef(null),\n    v = usePrevious(e);\n  useLayoutEffect(function () {\n    setTimeout(function () {\n      var a;\n      return null === (a = t.current) || void 0 === a ? void 0 : a.focus();\n    }, 2 * animateTimeout);\n  }, []), useLayoutEffect(function () {\n    setTimeout(function () {\n      var a;\n      null === (a = (0 <= m ? s[m] : u).current) || void 0 === a ? void 0 : a.focus();\n    }, v ? 2 * animateTimeout : 0), e && setTimeout(function () {\n      var a;\n      null === (a = t.current) || void 0 === a ? void 0 : a.focus();\n    }, j ? animateTimeout : 0);\n  }, [e]), useEffect(function () {\n    setTimeout(function () {\n      var a;\n      null === (a = (0 <= m ? s[m] : u).current) || void 0 === a ? void 0 : a.focus();\n    }, j ? animateTimeout : 0);\n  }, [m]);\n  return {\n    refs: s,\n    activeIndex: m,\n    onKeyDown: function onKeyDown(a) {\n      a.stopPropagation(), a.preventDefault();\n      var e = a.code;\n      if (\"ArrowUp\" === e) {\n        if (j && 0 > m - 1) {\n          var g;\n          u && (null === (g = u.current) || void 0 === g ? void 0 : g.focus());\n        }\n        n(Math.max(m - 1, j ? -1 : 0));\n      }\n      if (\"ArrowRight\" === e && 0 <= m) {\n        if (j) return void (!f(b[m]) || c(b[m]));\n        null !== q && void 0 !== q && q.includes(\"left\") && !f(b[m]) ? d() : c(b[m]);\n      }\n      if (\"ArrowDown\" === e && n(Math.min(m + 1, b.length - 1)), \"ArrowLeft\" === e && (null !== q && void 0 !== q && q.includes(\"right\") || j) && d(), \"Enter\" === e) if (!(0 <= m)) {\n        var k;\n        null === (k = u.current) || void 0 === k ? void 0 : k.click();\n      } else if (f(b[m])) c(b[m]);else {\n        var l;\n        null === (l = s[m].current) || void 0 === l ? void 0 : l.click();\n      }\n      if (\"Space\" === e) {\n        var o;\n        null === (o = (0 <= m ? s[m] : u).current) || void 0 === o ? void 0 : o.click();\n      }\n      \"Escape\" === e && (0 === h ? null === i || void 0 === i ? void 0 : i(a) : d());\n    },\n    setActiveIndex: n,\n    setDirection: r,\n    parentRef: u,\n    containerRef: t\n  };\n};","map":{"version":3,"names":["useEffect","useLayoutEffect","useRef","useState","usePrevious","useRefs","animateTimeout","useMenuNavigation","a","b","items","c","addLevel","d","deleteLevel","e","active","f","getItemSubMenu","g","level","h","i","onEsc","j","isMobile","k","l","_slicedToArray","m","n","o","p","q","r","s","length","t","u","v","setTimeout","current","focus","refs","activeIndex","onKeyDown","stopPropagation","preventDefault","code","Math","max","includes","min","click","setActiveIndex","setDirection","parentRef","containerRef"],"sources":["/Users/leonofv/Desktop/purchase-ui/node_modules/@consta/src/components/ContextMenu/useMenuNavigation.ts"],"sourcesContent":["import React, { useEffect, useLayoutEffect, useRef, useState } from 'react';\n\nimport { Direction } from '##/components/Popover';\nimport { usePrevious } from '##/hooks/usePrevious';\nimport { useRefs } from '##/hooks/useRefs';\nimport { animateTimeout } from '##/mixs/MixPopoverAnimate';\n\nimport { ContextMenuItemDefault, ContextMenuPropGetItemSubMenu } from './types';\n\ntype UseMenuNavigationProps<ITEM = ContextMenuItemDefault> = {\n  items: ITEM[];\n  deleteLevel: () => void;\n  getItemSubMenu: ContextMenuPropGetItemSubMenu<ITEM>;\n  active: boolean;\n  addLevel: (item: ITEM) => void;\n  onEsc?: React.KeyboardEventHandler;\n  level?: number;\n  isMobile?: boolean;\n};\n\nexport const useMenuNavigation = (props: UseMenuNavigationProps) => {\n  const {\n    items,\n    addLevel,\n    deleteLevel,\n    active,\n    getItemSubMenu,\n    level = 0,\n    onEsc,\n    isMobile,\n  } = props;\n\n  const [activeIndex, setActiveIndex] = useState(-1);\n\n  const [direction, setDirection] = useState<Direction | undefined>();\n\n  const refs = useRefs<HTMLDivElement>(items.length);\n\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const parentRef = useRef<HTMLDivElement>(null);\n\n  const previousFlag = usePrevious(active);\n\n  useLayoutEffect(() => {\n    setTimeout(() => containerRef.current?.focus(), animateTimeout * 2);\n  }, []);\n\n  useLayoutEffect(() => {\n    setTimeout(\n      () => {\n        (activeIndex >= 0 ? refs[activeIndex] : parentRef).current?.focus();\n      },\n      previousFlag ? animateTimeout * 2 : 0,\n    );\n    if (active) {\n      setTimeout(\n        () => {\n          containerRef.current?.focus();\n        },\n        isMobile ? animateTimeout : 0,\n      );\n    }\n  }, [active]);\n\n  useEffect(() => {\n    setTimeout(\n      () => {\n        (activeIndex >= 0 ? refs[activeIndex] : parentRef).current?.focus();\n      },\n      isMobile ? animateTimeout : 0,\n    );\n  }, [activeIndex]);\n\n  const onKeyDown = (e: React.KeyboardEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n    const { code } = e;\n\n    if (code === 'ArrowUp') {\n      if (isMobile) {\n        if (activeIndex - 1 < 0) {\n          parentRef && parentRef.current?.focus();\n        }\n      }\n      setActiveIndex(Math.max(activeIndex - 1, isMobile ? -1 : 0));\n    }\n    if (code === 'ArrowRight' && activeIndex >= 0) {\n      if (isMobile) {\n        !!getItemSubMenu(items[activeIndex]) && addLevel(items[activeIndex]);\n        return;\n      }\n      if (direction?.includes('left') && !getItemSubMenu(items[activeIndex])) {\n        deleteLevel();\n      } else {\n        addLevel(items[activeIndex]);\n      }\n    }\n    if (code === 'ArrowDown') {\n      setActiveIndex(Math.min(activeIndex + 1, items.length - 1));\n    }\n    if (code === 'ArrowLeft') {\n      if (direction?.includes('right') || isMobile) {\n        deleteLevel();\n      }\n    }\n    if (code === 'Enter') {\n      if (activeIndex >= 0) {\n        if (getItemSubMenu(items[activeIndex])) {\n          addLevel(items[activeIndex]);\n        } else {\n          refs[activeIndex].current?.click();\n        }\n      } else {\n        parentRef.current?.click();\n      }\n    }\n    if (code === 'Space') {\n      (activeIndex >= 0 ? refs[activeIndex] : parentRef).current?.click();\n    }\n    if (code === 'Escape') {\n      if (level === 0) {\n        onEsc?.(e);\n      } else {\n        deleteLevel();\n      }\n    }\n  };\n\n  return {\n    refs,\n    activeIndex,\n    onKeyDown,\n    setActiveIndex,\n    setDirection,\n    parentRef,\n    containerRef,\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}