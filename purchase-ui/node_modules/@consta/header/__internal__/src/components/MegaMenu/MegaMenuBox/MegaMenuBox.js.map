{"version":3,"file":"MegaMenuBox.js","names":["PortalWithTheme","usePortalContext","useTheme","useClickOutside","React","useMemo","useRef","Transition","cn","cnMegaMenuBox","ContextConsumer","onClickOutside","children","ignoreClicksInsideRefs","refs","isActive","handler","MegaMenuBox","props","isOpen","onEsc","offset","offsetProp","style","anchorRef","className","maxContentWidth","otherProps","_objectWithoutProperties","_excluded","containerRef","menuRef","theme","a","b","c","d","current","offsetTop","offsetHeight","createElement","in","unmountOnExit","timeout","nodeRef","animate","Object","assign","preset","_objectSpread","\"--mega-menu-offset\"","ref","\"--mega-menu-content-width\""],"sources":["../../../../../../src/components/MegaMenu/MegaMenuBox/MegaMenuBox.tsx"],"sourcesContent":["import './MegaMenuBox.css';\n\nimport {\n  PortalWithTheme,\n  usePortalContext,\n} from '@consta/uikit/PortalWithTheme';\nimport { useTheme } from '@consta/uikit/Theme';\nimport { useClickOutside } from '@consta/uikit/useClickOutside';\nimport React, { useMemo, useRef } from 'react';\nimport { Transition } from 'react-transition-group';\n\nimport { cn } from '##/utils/bem';\n\nimport { MegaMenuBoxProps } from './types';\n\nconst cnMegaMenuBox = cn('MegaMenuBox');\n\nconst ContextConsumer: React.FC<{\n  onClickOutside?: (event: MouseEvent) => void;\n  ignoreClicksInsideRefs?: ReadonlyArray<React.RefObject<HTMLElement>>;\n  children: React.ReactNode;\n}> = ({ onClickOutside, children, ignoreClicksInsideRefs }) => {\n  const { refs } = usePortalContext();\n\n  useClickOutside({\n    isActive: !!onClickOutside,\n    ignoreClicksInsideRefs: [\n      ...(ignoreClicksInsideRefs || []),\n      ...(refs || []),\n    ],\n    handler: onClickOutside,\n  });\n\n  return children as React.ReactElement;\n};\n\nexport const MegaMenuBox = (props: MegaMenuBoxProps) => {\n  const {\n    isOpen,\n    onClickOutside,\n    onEsc,\n    offset: offsetProp = 0,\n    style,\n    anchorRef,\n    className,\n    children,\n    maxContentWidth,\n    ...otherProps\n  } = props;\n\n  const containerRef = useRef<HTMLDivElement>(null);\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  const { theme } = useTheme();\n\n  const offset = useMemo(() => {\n    return (\n      (anchorRef?.current?.offsetTop ?? 0) +\n      (anchorRef?.current?.offsetHeight ?? 0) +\n      offsetProp\n    );\n  }, [offsetProp, anchorRef?.current]);\n\n  return (\n    <Transition in={isOpen} unmountOnExit timeout={240} nodeRef={containerRef}>\n      {(animate) => (\n        <PortalWithTheme\n          preset={theme}\n          style={{\n            ['--mega-menu-offset' as string]: `${offset}px`,\n            ...style,\n          }}\n          className={cnMegaMenuBox(null, [className])}\n          ref={containerRef}\n          {...otherProps}\n        >\n          <div className={cnMegaMenuBox('Overlay', { animate })} />\n          <ContextConsumer\n            onClickOutside={onClickOutside}\n            ignoreClicksInsideRefs={[menuRef]}\n          >\n            <div ref={menuRef} className={cnMegaMenuBox('Window', { animate })}>\n              <div\n                className={cnMegaMenuBox('Wrapper')}\n                style={{\n                  ['--mega-menu-content-width' as string]: maxContentWidth\n                    ? `${maxContentWidth}px`\n                    : '100%',\n                }}\n              >\n                {children}\n              </div>\n            </div>\n          </ContextConsumer>\n        </PortalWithTheme>\n      )}\n    </Transition>\n  );\n};\n"],"mappings":"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"}