{"version":3,"file":"Menu.js","names":["IconMeatball","IconSelect","Button","ContextMenu","animateTimeout","useDebounce","useFlag","useHideElementsInLine","useMutableRef","React","forwardRef","useCallback","useEffect","useRef","useState","getItemClick","cn","withDefaultGetters","cnMenu","MenuRender","props","ref","c","d","items","className","width","getItemActive","getItemHref","getItemLabel","getItemOnClick","getItemTarget","getItemSubMenu","onItemClick","otherProps","_objectWithoutProperties","_excluded","openedSubMenu","setOpenedSubMenu","mouseOnMenu","setMouseOnMenu","visibleItems","itemsRefs","wrapperRef","hiddenItems","moreRef","moreButtonRef","getItemHrefRef","getItemTargetRef","getItemAs","item","current","getItemHTMLAttributes","href","target","_objectSpread","elementZIndex","style","zIndex","createElement","Object","assign","onMouseLeave","off","onMouseEnter","on","map","index","label","active","Tag","subItems","opened","hidden","key","g","onClick","size","isOpen","length","anchorRef","e","direction","possibleDirections","spareDirection","getItemAttributes","more","iconLeft","view","offset","Menu"],"sources":["../../../../../src/components/Menu/Menu.tsx"],"sourcesContent":["import './Menu.css';\n\nimport { IconMeatball } from '@consta/icons/IconMeatball';\nimport { IconSelect } from '@consta/icons/IconSelect';\nimport { Button } from '@consta/uikit/Button';\nimport { ContextMenu } from '@consta/uikit/ContextMenu';\nimport { animateTimeout } from '@consta/uikit/MixPopoverAnimate';\nimport { useDebounce } from '@consta/uikit/useDebounce';\nimport { useFlag } from '@consta/uikit/useFlag';\nimport { useHideElementsInLine } from '@consta/uikit/useHideElementsInLineDepricated';\nimport { useMutableRef } from '@consta/uikit/useMutableRef';\nimport React, {\n  forwardRef,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\n\nimport { getItemClick } from '##/helpers/getItemClick';\nimport { cn } from '##/utils/bem';\n\nimport { withDefaultGetters } from './helpers';\nimport { MenuComponent, MenuProps } from './types';\n\nexport const cnMenu = cn('Menu');\n\nconst MenuRender = (props: MenuProps, ref: React.Ref<HTMLDivElement>) => {\n  const {\n    items,\n    className,\n    width,\n    getItemActive,\n    getItemHref,\n    getItemLabel,\n    getItemOnClick,\n    getItemTarget,\n    getItemSubMenu,\n    onItemClick,\n    ...otherProps\n  } = withDefaultGetters(props);\n\n  const [openedSubMenu, setOpenedSubMenu] = useState<\n    number | 'more' | undefined\n  >();\n  const [mouseOnMenu, setMouseOnMenu] = useFlag();\n\n  const { visibleItems, itemsRefs, wrapperRef, hiddenItems, moreRef } =\n    useHideElementsInLine<\n      (typeof items)[number],\n      HTMLLIElement,\n      HTMLUListElement\n    >(items);\n\n  const moreButtonRef = useRef<HTMLButtonElement>(null);\n\n  const getItemHrefRef = useMutableRef(getItemHref);\n  const getItemTargetRef = useMutableRef(getItemTarget);\n\n  const getItemAs = useCallback((item: (typeof items)[number]) => {\n    if (getItemHrefRef.current(item)) {\n      return 'a';\n    }\n    return 'span';\n  }, []);\n\n  const getItemHTMLAttributes = useCallback((item: (typeof items)[number]) => {\n    const href = getItemHrefRef.current(item);\n    const target = getItemTargetRef.current(item);\n\n    return {\n      ...(href && { href: getItemHrefRef.current(item) }),\n      ...(target && { href: getItemTargetRef.current(item) }),\n    };\n  }, []);\n\n  const elementZIndex =\n    typeof props.style?.zIndex === 'number'\n      ? props.style.zIndex + 1\n      : undefined;\n\n  useEffect(\n    useDebounce(() => {\n      if (!mouseOnMenu) {\n        setOpenedSubMenu(undefined);\n      }\n    }, animateTimeout),\n    [mouseOnMenu],\n  );\n\n  return (\n    <nav\n      {...otherProps}\n      className={cnMenu({ width }, [className])}\n      onMouseLeave={setMouseOnMenu.off}\n      onMouseEnter={setMouseOnMenu.on}\n      ref={ref}\n    >\n      <ul className={cnMenu('List')} ref={wrapperRef}>\n        {items.map((item, index) => {\n          const label = getItemLabel(item);\n          const href = getItemHref(item);\n          const target = href ? getItemTarget(item) : undefined;\n          const active = getItemActive(item);\n          const Tag = href ? 'a' : 'span';\n          const subItems = getItemSubMenu(item);\n          const opened = openedSubMenu === index;\n          const hidden = !visibleItems[index];\n          return (\n            <li\n              className={cnMenu('Item', { hidden, active, opened })}\n              key={cnMenu('Item', { index })}\n              ref={itemsRefs[index]}\n              onMouseEnter={() => setOpenedSubMenu(index)}\n            >\n              <Tag\n                className={cnMenu('Link')}\n                href={href}\n                target={target}\n                onClick={getItemClick(item, getItemOnClick, onItemClick)}\n              >\n                {label}\n              </Tag>\n              {subItems && <IconSelect size=\"s\" className={cnMenu('Arrow')} />}\n              <ContextMenu\n                isOpen={subItems && subItems.length > 0 && opened}\n                items={subItems || []}\n                getItemLabel={getItemLabel}\n                getItemSubMenu={getItemSubMenu}\n                anchorRef={itemsRefs[index]}\n                onItemClick={(item, { e }) =>\n                  getItemClick(item, getItemOnClick, onItemClick)(e)\n                }\n                direction=\"downStartLeft\"\n                possibleDirections={[\n                  'upStartLeft',\n                  'downStartRight',\n                  'downStartLeft',\n                  'upStartRight',\n                ]}\n                spareDirection=\"downStartLeft\"\n                getItemAs={getItemAs}\n                getItemAttributes={getItemHTMLAttributes}\n                style={{ zIndex: elementZIndex }}\n              />\n            </li>\n          );\n        })}\n        {hiddenItems.length > 0 && (\n          <li\n            className={cnMenu('Item')}\n            key={cnMenu('Item', { more: true })}\n            ref={moreRef}\n            onMouseEnter={() => setOpenedSubMenu('more')}\n          >\n            <Button\n              iconLeft={IconMeatball}\n              ref={moreButtonRef}\n              size=\"xs\"\n              view=\"clear\"\n            />\n            <ContextMenu\n              isOpen={openedSubMenu === 'more'}\n              items={hiddenItems}\n              getItemLabel={getItemLabel}\n              getItemSubMenu={getItemSubMenu}\n              anchorRef={moreButtonRef}\n              onItemClick={(item, { e }) =>\n                getItemClick(item, getItemOnClick, onItemClick)(e)\n              }\n              direction=\"downStartLeft\"\n              possibleDirections={[\n                'upStartLeft',\n                'downStartRight',\n                'downStartLeft',\n                'upStartRight',\n              ]}\n              spareDirection=\"downStartRight\"\n              getItemAs={getItemAs}\n              getItemAttributes={getItemHTMLAttributes}\n              style={{ zIndex: elementZIndex }}\n              offset={8}\n            />\n          </li>\n        )}\n      </ul>\n    </nav>\n  );\n};\n\nexport const Menu = forwardRef(MenuRender) as MenuComponent;\n\nexport * from './types';\n"],"mappings":"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"}