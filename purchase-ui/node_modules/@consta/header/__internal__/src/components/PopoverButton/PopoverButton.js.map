{"version":3,"file":"PopoverButton.js","names":["Button","animateTimeout","cnMixPopoverAnimate","cnMixPopoverArrow","Popover","useFlag","useForkRef","React","forwardRef","useRef","useState","Transition","Sidebar","cn","cnPopoverButton","DEFAULT_POPOVER_ARROW_SIZE","DEFAULT_POPOVER_ARROW_OFFSET","PopoverButton","props","ref","c","size","view","children","className","onClick","withCloseButton","popoverClassName","isMobile","title","otherProps","_objectWithoutProperties","_excluded","isOpen","setIsOpen","direction","setDirection","buttonRef","zIndex","style","createElement","Fragment","Object","assign","e","toggle","onClickOutside","off","onClose","timeout","unmountOnExit","in","animate","anchorRef","arrowOffset","offset","onSetDirection","\"--popover-arrow-size\"","\"--popover-arrow-offset\""],"sources":["../../../../../src/components/PopoverButton/PopoverButton.tsx"],"sourcesContent":["import './PopoverButton.css';\n\nimport { Button } from '@consta/uikit/Button';\nimport {\n  animateTimeout,\n  cnMixPopoverAnimate,\n} from '@consta/uikit/MixPopoverAnimate';\nimport { cnMixPopoverArrow } from '@consta/uikit/MixPopoverArrow';\nimport { Direction, Popover } from '@consta/uikit/Popover';\nimport { useFlag } from '@consta/uikit/useFlag';\nimport { useForkRef } from '@consta/uikit/useForkRef';\nimport React, { forwardRef, useRef, useState } from 'react';\nimport { Transition } from 'react-transition-group';\n\nimport { Sidebar } from '##/components/Sidebar';\nimport { cn } from '##/utils/bem';\n\nconst cnPopoverButton = cn('PopoverButton');\n\ntype PopoverButtonProps = Omit<\n  React.ComponentProps<typeof Button>,\n  'children'\n> & {\n  children?: React.ReactNode | ((onClose: () => void) => React.ReactNode);\n  isMobile?: boolean;\n  popoverClassName?: string;\n  withCloseButton?: boolean;\n};\n\nconst DEFAULT_POPOVER_ARROW_SIZE = 6;\nconst DEFAULT_POPOVER_ARROW_OFFSET = 10;\n\nexport const PopoverButton = forwardRef<HTMLButtonElement, PopoverButtonProps>(\n  (props, ref) => {\n    const {\n      size = 's',\n      view = 'clear',\n      children,\n      className,\n      onClick,\n      withCloseButton = true,\n      popoverClassName,\n      isMobile,\n      title,\n      ...otherProps\n    } = props;\n\n    const [isOpen, setIsOpen] = useFlag();\n    const [direction, setDirection] = useState<Direction | undefined>(\n      undefined,\n    );\n\n    const buttonRef = useRef<HTMLButtonElement>(null);\n\n    const handleClick: React.MouseEventHandler = (e) => {\n      onClick?.(e);\n      setIsOpen.toggle();\n    };\n\n    const zIndex =\n      typeof props.style?.zIndex === 'number'\n        ? props.style.zIndex + 1\n        : undefined;\n\n    return (\n      <>\n        <Button\n          ref={useForkRef([ref, buttonRef])}\n          size={size}\n          view={view}\n          onClick={handleClick}\n          className={cnPopoverButton(null, [className])}\n          {...otherProps}\n        />\n        {isMobile ? (\n          <Sidebar\n            isOpen={isOpen}\n            onClickOutside={setIsOpen.off}\n            className={cnPopoverButton('Sidebar', [popoverClassName])}\n            onClose={withCloseButton ? setIsOpen.off : undefined}\n            title={title}\n            style={{ zIndex }}\n          >\n            {typeof children === 'function'\n              ? children?.(setIsOpen.off)\n              : children}\n          </Sidebar>\n        ) : (\n          <Transition timeout={animateTimeout} unmountOnExit in={isOpen}>\n            {(animate) => (\n              <Popover\n                className={cnPopoverButton('Popover', [\n                  popoverClassName,\n                  cnMixPopoverAnimate({ animate, direction }),\n                ])}\n                anchorRef={buttonRef}\n                arrowOffset={\n                  DEFAULT_POPOVER_ARROW_SIZE + DEFAULT_POPOVER_ARROW_OFFSET\n                }\n                offset={DEFAULT_POPOVER_ARROW_SIZE + 4}\n                onSetDirection={setDirection}\n                style={{\n                  ['--popover-arrow-size' as string]: `${DEFAULT_POPOVER_ARROW_SIZE}px`,\n                  ['--popover-arrow-offset' as string]: `${DEFAULT_POPOVER_ARROW_OFFSET}px`,\n                  zIndex,\n                }}\n                onClickOutside={setIsOpen.off}\n              >\n                <div\n                  className={cnPopoverButton('Arrow', [\n                    cnMixPopoverArrow({ direction }),\n                  ])}\n                />\n                {typeof children === 'function'\n                  ? children?.(setIsOpen.off)\n                  : children}\n              </Popover>\n            )}\n          </Transition>\n        )}\n      </>\n    );\n  },\n);\n"],"mappings":"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"}