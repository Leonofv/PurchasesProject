{"version":3,"file":"VerticalMenu.js","names":["cnForCssTransition","useDebounce","useFlag","useMutableRef","useRefs","React","forwardRef","useCallback","useEffect","useState","CSSTransition","TransitionGroup","getItemClick","cn","withDefaultGetters","VerticalMenuLevel","cnVerticalMenu","transitionCn","VerticalMenuRender","props","ref","c","items","className","getItemActive","getItemHref","getItemLabel","getItemOnClick","getItemTarget","getItemSubMenu","header","onItemClick","getItemGroup","footer","otherProps","_objectWithoutProperties","_excluded","levels","setLevels","id","animationBack","setAnimationBack","levelRefs","length","disableAnimationBack","off","addLevel","level","l","newLevels","Array","from","push","removeLevel","on","pop","getItemSubMenuRef","getItemLabelRef","keys","split","slice","forEach","index","item","levelItems","current","levelLabel","label","createElement","Object","assign","enter","exit","map","levelNum","classNames","key","timeout","nodeRef","menuItem","VerticalMenu"],"sources":["../../../../../src/components/VerticalMenu/VerticalMenu.tsx"],"sourcesContent":["import './VerticalMenu.css';\n\nimport { cnForCssTransition } from '@consta/uikit/__internal__/src/utils/cnForCssTransition';\nimport { useDebounce } from '@consta/uikit/useDebounce';\nimport { useFlag } from '@consta/uikit/useFlag';\nimport { useMutableRef } from '@consta/uikit/useMutableRef';\nimport { useRefs } from '@consta/uikit/useRefs';\nimport React, { forwardRef, useCallback, useEffect, useState } from 'react';\nimport { CSSTransition, TransitionGroup } from 'react-transition-group';\n\nimport { getItemClick } from '##/helpers/getItemClick';\nimport { cn } from '##/utils/bem';\n\nimport { withDefaultGetters } from './helpers';\nimport {\n  VerticalMenuComponent,\n  VerticalMenuDefaultItem,\n  VerticalMenuLevel as VerticalMenuLevelType,\n  VerticalMenuProps,\n} from './types';\nimport { VerticalMenuLevel } from './VerticalMenuLevel/VerticalMenuLevel';\n\nexport const cnVerticalMenu = cn('VerticalMenu');\n\nconst transitionCn = cnForCssTransition(cnVerticalMenu, 'Level');\n\nconst VerticalMenuRender = (\n  props: VerticalMenuProps,\n  ref: React.Ref<HTMLDivElement>,\n) => {\n  const {\n    items,\n    className,\n    getItemActive,\n    getItemHref,\n    getItemLabel,\n    getItemOnClick,\n    getItemTarget,\n    getItemSubMenu,\n    header,\n    onItemClick,\n    getItemGroup,\n    footer,\n    ...otherProps\n  } = withDefaultGetters(props);\n\n  const [levels, setLevels] = useState<\n    Array<VerticalMenuLevelType<VerticalMenuDefaultItem>>\n  >([{ items, id: '0' }]);\n  const [animationBack, setAnimationBack] = useFlag();\n\n  const levelRefs = useRefs<HTMLDivElement>(levels.length);\n\n  const disableAnimationBack = useDebounce(setAnimationBack.off, 250);\n\n  const addLevel = useCallback(\n    (level: VerticalMenuLevelType<(typeof items)[number]>) =>\n      setLevels((l) => {\n        const newLevels = Array.from(l);\n        newLevels.push(level);\n        return newLevels;\n      }),\n    [],\n  );\n\n  const removeLevel = useCallback(() => {\n    setAnimationBack.on();\n    setLevels((l) => {\n      const newLevels = Array.from(l);\n      newLevels.pop();\n      return newLevels;\n    });\n    disableAnimationBack();\n  }, []);\n\n  const getItemSubMenuRef = useMutableRef(getItemSubMenu);\n  const getItemLabelRef = useMutableRef(getItemLabel);\n\n  useEffect(() => {\n    // обновляем уровни при смене items\n    const keys = levels[levels.length - 1].id.split('-').slice(1);\n\n    let id = '0';\n\n    const newLevels: Array<VerticalMenuLevelType<VerticalMenuDefaultItem>> = [\n      { items, id },\n    ];\n\n    keys.forEach((index) => {\n      const item = newLevels[newLevels.length - 1].items[Number(index)];\n\n      if (!item) {\n        return;\n      }\n\n      const levelItems = getItemSubMenuRef.current(item);\n      const levelLabel = getItemLabelRef.current(item);\n      id = `${id}-${index}`;\n\n      if (!levelItems) {\n        return;\n      }\n\n      newLevels.push({ items: levelItems, label: levelLabel, id });\n    });\n\n    setLevels(newLevels);\n  }, [items]);\n\n  return (\n    <div\n      {...otherProps}\n      className={cnVerticalMenu({ animationBack }, [className])}\n      ref={ref}\n    >\n      <TransitionGroup enter exit className={cnVerticalMenu('Levels')}>\n        {levels.map((level, index) => {\n          const levelNum = index + 1;\n          if (levelNum >= levels.length) {\n            return (\n              <CSSTransition\n                classNames={transitionCn}\n                key={levelNum}\n                timeout={250}\n                nodeRef={levelRefs[index]}\n              >\n                <VerticalMenuLevel\n                  ref={levelRefs[index]}\n                  id={level.id}\n                  items={level.items}\n                  label={level.label}\n                  addLevel={addLevel}\n                  removeLevel={removeLevel}\n                  className={cnVerticalMenu('Level', {\n                    current: levelNum === levels.length,\n                  })}\n                  key={levelNum}\n                  header={index === 0 && header}\n                  footer={index === 0 && footer}\n                  getItemActive={getItemActive}\n                  getItemHref={getItemHref}\n                  getItemLabel={getItemLabel}\n                  getItemOnClick={(menuItem) =>\n                    getItemClick(menuItem, getItemOnClick, onItemClick)\n                  }\n                  getItemTarget={getItemTarget}\n                  getItemSubMenu={getItemSubMenu}\n                  getItemGroup={getItemGroup}\n                />\n              </CSSTransition>\n            );\n          }\n          return null;\n        })}\n      </TransitionGroup>\n    </div>\n  );\n};\n\nexport const VerticalMenu = forwardRef(\n  VerticalMenuRender,\n) as VerticalMenuComponent;\n\nexport * from './types';\n"],"mappings":"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"}