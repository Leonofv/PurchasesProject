{"version":3,"file":"useAutoComplete.js","names":["useCallback","useEffect","useMemo","useRef","useState","scrollToIndex","useClickOutside","useFlag","useKeys","useRefs","getGroups","useAutoComplete","params","items","dropdownRef","controlRef","disabled","getItemLabel","getItemKey","searchFunction","getItemGroupKey","groups","getGroupKey","onFocus","onBlur","searchValue","isLoading","dropdownOpen","onDropdownOpen","ignoreOutsideClicksRefs","inputRef","isOpen","setIsOpen","highlightedIndex","setHighlightedIndex","searchFunctionDefault","item","toLocaleLowerCase","indexOf","filteredOptions","filter","visibleItems","resultGroups","length","hasItems","find","group","highlightIndex","indexForHighlight","Math","min","max","onChange","e","value","ArrowUp","_","preventDefault","on","old","ArrowDown","getKeyProps","PageUp","PageDown","Home","End","Enter","getItem","index","couter","Escape","off","Tab","optionsRefs","isActive","ignoreClicksInsideRefs","handler","current","blur","set","getOptionProps","key","onClick","onMouseEnter","active","hovered","handleInputFocus","toggle","handleInputBlur","focus"],"sources":["../../../../../src/components/AutoComplete/useAutoComplete.ts"],"sourcesContent":["import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport { scrollToIndex } from '##/components/SelectComponents/useSelect/helpers';\nimport { useClickOutside } from '##/hooks/useClickOutside';\nimport { useFlag } from '##/hooks/useFlag';\nimport { KeyHandler, useKeys } from '##/hooks/useKeysDepricated';\nimport { useRefs } from '##/hooks/useRefs';\nimport { getGroups } from '##/utils/getGroups';\n\ntype IndexForHighlight = number | ((oldIndex: number) => number);\n\ntype GetItemGroupKey<ITEM> = (item: ITEM) => string | number | undefined;\ntype GetGroupKey<GROUP> = (item: GROUP) => string | number | undefined;\n\ntype OnChangeProp<ITEM> = (props: {\n  value: ITEM | null;\n  e: React.SyntheticEvent;\n}) => void;\n\ntype UseAutoCompleteProps<ITEM, GROUP> = {\n  getItemGroupKey?: GetItemGroupKey<ITEM> | undefined;\n  getGroupKey?: GetGroupKey<GROUP>;\n  groups?: GROUP[];\n  items: ITEM[];\n  dropdownRef: React.MutableRefObject<HTMLDivElement | null>;\n  controlRef: React.MutableRefObject<HTMLDivElement | null>;\n  disabled?: boolean;\n  getItemLabel: (item: ITEM) => string;\n  getItemKey: (item: ITEM) => string | number;\n  searchFunction?: (item: ITEM, searchValue: string) => boolean;\n  onFocus?: React.FocusEventHandler<HTMLInputElement>;\n  onBlur?: React.FocusEventHandler<HTMLInputElement>;\n  searchValue?: string;\n  onChange: OnChangeProp<ITEM>;\n  isLoading?: boolean;\n  dropdownOpen?: boolean;\n  onDropdownOpen?: (isOpen: boolean) => void;\n  ignoreOutsideClicksRefs?: ReadonlyArray<React.RefObject<HTMLElement>>;\n};\n\ntype OptionProps<ITEM> = {\n  index: number;\n  item: ITEM;\n  keyPrefix: number;\n};\n\ntype GetOptionPropsResult = {\n  onClick: (e: React.SyntheticEvent) => void;\n  onMouseEnter: (e: React.SyntheticEvent) => void;\n  active: boolean;\n  hovered: boolean;\n  key: string | number;\n};\n\nexport function useAutoComplete<ITEM, GROUP>(\n  params: UseAutoCompleteProps<ITEM, GROUP>,\n) {\n  const {\n    items,\n    dropdownRef,\n    controlRef,\n    disabled = false,\n    getItemLabel,\n    getItemKey,\n    searchFunction,\n    getItemGroupKey,\n    groups,\n    getGroupKey,\n    onFocus,\n    onBlur,\n    searchValue,\n    isLoading,\n    dropdownOpen,\n    onDropdownOpen,\n    ignoreOutsideClicksRefs,\n  } = params;\n\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [isOpen, setIsOpen] = useFlag();\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(0);\n\n  const searchFunctionDefault = (item: ITEM, searchValue: string) => {\n    if (!searchValue) {\n      return false;\n    }\n    return (\n      getItemLabel(item)\n        .toLocaleLowerCase()\n        .indexOf(searchValue.toLocaleLowerCase()) !== -1\n    );\n  };\n\n  const filteredOptions = useMemo(\n    () =>\n      items.filter((item) =>\n        searchFunction\n          ? searchFunction(item, searchValue || '')\n          : searchFunctionDefault(item, searchValue || ''),\n      ),\n    [searchValue, items],\n  );\n\n  const visibleItems = useMemo(() => {\n    const resultGroups = getGroups(\n      filteredOptions,\n      groups?.length ? getItemGroupKey : undefined,\n      groups,\n      getGroupKey,\n      undefined,\n    );\n\n    return resultGroups;\n  }, [filteredOptions, groups, getItemGroupKey, getGroupKey]);\n\n  const hasItems = useMemo(() => {\n    return !!visibleItems.find((group) => group.items.length > 0);\n  }, [visibleItems]);\n\n  const highlightIndex = useCallback(\n    (indexForHighlight: IndexForHighlight) => {\n      setHighlightedIndex(\n        Math.min(\n          Math.max(\n            0,\n            typeof indexForHighlight === 'function'\n              ? indexForHighlight(highlightedIndex)\n              : indexForHighlight,\n          ),\n          filteredOptions.length - 1,\n        ),\n      );\n    },\n    [filteredOptions, highlightedIndex],\n  );\n\n  const onChange = (e: React.SyntheticEvent, item: ITEM) => {\n    if (!disabled) {\n      params.onChange({ value: item, e });\n    }\n  };\n\n  // Prop Getters\n\n  const ArrowUp: KeyHandler = (_, e): void => {\n    if (!disabled) {\n      e.preventDefault();\n      setIsOpen.on();\n      highlightIndex((old) => old - 1);\n    }\n  };\n\n  const ArrowDown: KeyHandler = (_, e): void => {\n    if (!disabled) {\n      e.preventDefault();\n      setIsOpen.on();\n      highlightIndex((old) => old + 1);\n    }\n  };\n\n  const Enter: KeyHandler = (_, e): void => {\n    if (isOpen) {\n      if (searchValue || filteredOptions[highlightedIndex]) {\n        e.preventDefault();\n      }\n\n      const getItem = (index: number) => {\n        let couter = 0;\n        for (const group of visibleItems) {\n          if (group.items.length + couter > index) {\n            return group.items[index - couter];\n          }\n          couter += group.items.length;\n        }\n        return undefined;\n      };\n\n      const item = getItem(highlightedIndex);\n\n      if (item) {\n        onChange(e, item);\n      }\n    } else {\n      setIsOpen.on();\n    }\n  };\n\n  const Escape: KeyHandler = (): void => {\n    setIsOpen.off();\n  };\n\n  const Tab: KeyHandler = (_, e): void => {\n    setIsOpen.off();\n    if (isOpen && hasItems) {\n      e.preventDefault();\n    }\n  };\n\n  const getKeyProps = useKeys({\n    ArrowUp,\n    ArrowDown,\n    PageUp: ArrowUp,\n    PageDown: ArrowDown,\n    Home: ArrowUp,\n    End: ArrowDown,\n    Enter,\n    Escape,\n    Tab,\n  });\n\n  const getOptionProps = ({\n    index,\n    item,\n  }: OptionProps<ITEM>): GetOptionPropsResult => {\n    const key = getItemKey(item);\n    return {\n      onClick: (e: React.SyntheticEvent) => {\n        onChange(e, item);\n      },\n      onMouseEnter: () => {\n        highlightIndex(index);\n      },\n      active: false,\n      hovered: index === highlightedIndex,\n      key,\n    };\n  };\n\n  const optionsRefs = useRefs<HTMLDivElement>(filteredOptions.length, [isOpen]);\n\n  const handleInputFocus = (e: React.FocusEvent<HTMLInputElement>): void => {\n    if (!disabled) {\n      setIsOpen.toggle();\n\n      if (typeof onFocus === 'function') {\n        onFocus(e);\n      }\n    }\n  };\n\n  const handleInputBlur = (e: React.FocusEvent<HTMLInputElement>): void => {\n    if (isOpen) {\n      inputRef.current?.focus();\n      return;\n    }\n\n    if (typeof onBlur === 'function') {\n      onBlur(e);\n    }\n  };\n\n  useClickOutside({\n    isActive: isOpen,\n    ignoreClicksInsideRefs: [\n      dropdownRef,\n      controlRef,\n      ...(ignoreOutsideClicksRefs || []),\n    ],\n    handler: setIsOpen.off,\n  });\n\n  useEffect(() => {\n    if (disabled) {\n      setIsOpen.off();\n      inputRef.current?.blur();\n    }\n  }, [disabled]);\n\n  useEffect(() => {\n    if (filteredOptions.length > 0) {\n      scrollToIndex(highlightedIndex, dropdownRef, optionsRefs, () =>\n        highlightIndex(0),\n      );\n    }\n    setIsOpen.on();\n  }, [highlightedIndex]);\n\n  useEffect(() => {\n    onDropdownOpen?.(isOpen);\n  }, [isOpen]);\n\n  useEffect(() => {\n    setIsOpen.set(dropdownOpen || false);\n  }, [dropdownOpen]);\n\n  useEffect(() => {\n    if (searchValue) {\n      setIsOpen.on();\n    }\n  }, [searchValue]);\n\n  return {\n    isOpen: Boolean(isOpen && (isLoading ? true : hasItems)),\n    visibleItems,\n    getOptionProps,\n    handleInputFocus,\n    handleInputBlur,\n    inputRef,\n    getKeyProps,\n    hasItems,\n    optionsRefs,\n  };\n}\n"],"mappings":"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"}