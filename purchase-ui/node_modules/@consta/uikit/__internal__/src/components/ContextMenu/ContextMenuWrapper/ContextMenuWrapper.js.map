{"version":3,"file":"ContextMenuWrapper.js","names":["React","Fragment","useCallback","useState","Transition","cnListBox","mapVerticalSpase","Popover","useFlag","useMutableRef","animateTimeout","cnMixPopoverAnimate","cnMixSpace","cn","contextMenuDefaultSize","defaultContextMenuForm","cnContextMenuWrapper","ContextMenuWrapper","props","isMobile","children","form","isOpen","size","anchorRef","possibleDirections","position","directionProp","direction","spareDirection","onClickOutside","offset","onSetDirectionProp","onSetDirection","className","animationBack","style","innerAnimation","setInnerAnimation","setSirection","onSetDirectionRef","current","on","off","animate","border","shadow","pV","name"],"sources":["../../../../../../src/components/ContextMenu/ContextMenuWrapper/ContextMenuWrapper.tsx"],"sourcesContent":["import './ContextMenuWrapper.css';\n\nimport React, { Fragment, useCallback, useState } from 'react';\nimport { Transition } from 'react-transition-group';\n\nimport { cnListBox, mapVerticalSpase } from '##/components/ListCanary';\nimport { Direction, Popover } from '##/components/Popover';\nimport { useFlag } from '##/hooks/useFlag';\nimport { useMutableRef } from '##/hooks/useMutableRef';\nimport { animateTimeout, cnMixPopoverAnimate } from '##/mixs/MixPopoverAnimate';\nimport { cnMixSpace } from '##/mixs/MixSpace';\nimport { cn } from '##/utils/bem';\n\nimport {\n  contextMenuDefaultSize,\n  ContextMenuWrapperProps,\n  defaultContextMenuForm,\n} from '../types';\n\nconst cnContextMenuWrapper = cn('ContextMenuWrapper');\n\nexport const ContextMenuWrapper = (props: ContextMenuWrapperProps) => {\n  const {\n    isMobile,\n    children,\n    form = defaultContextMenuForm,\n    isOpen,\n    size = contextMenuDefaultSize,\n    anchorRef,\n    possibleDirections,\n    position,\n    direction: directionProp,\n    spareDirection,\n    onClickOutside,\n    offset,\n    onSetDirection: onSetDirectionProp,\n    className,\n    animationBack,\n    style,\n  } = props;\n\n  const [innerAnimation, setInnerAnimation] = useFlag(isMobile);\n  // запоминаем позицию посднего удовлетворяющего разворота,\n  // для того чтоб следующий экран разворачивался в эту же строну.\n  const [direction, setSirection] = useState(directionProp);\n\n  const onSetDirectionRef = useMutableRef(onSetDirectionProp);\n\n  const onSetDirection = useCallback((direction: Direction) => {\n    setSirection(direction);\n    onSetDirectionRef.current?.(direction);\n  }, []);\n\n  if (isMobile) {\n    return (\n      <Transition\n        timeout={animateTimeout}\n        in={isOpen}\n        unmountOnExit\n        onEntered={setInnerAnimation.on}\n        onExit={setInnerAnimation.off}\n      >\n        {(animate) => (\n          <Popover\n            className={cnContextMenuWrapper({ animationBack, innerAnimation }, [\n              cnListBox({ size, form, border: true, shadow: true }),\n              cnMixSpace({\n                pV: mapVerticalSpase[size],\n              }),\n              cnMixPopoverAnimate({ animate }),\n              className,\n            ])}\n            anchorRef={anchorRef}\n            possibleDirections={possibleDirections}\n            position={position}\n            direction={direction}\n            spareDirection={spareDirection}\n            onClickOutside={onClickOutside}\n            offset={offset}\n            onSetDirection={onSetDirection}\n            style={style}\n          >\n            {children}\n          </Popover>\n        )}\n      </Transition>\n    );\n  }\n\n  return <Fragment key={ContextMenuWrapper.name}>{children}</Fragment>;\n};\n"],"mappings":"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"}