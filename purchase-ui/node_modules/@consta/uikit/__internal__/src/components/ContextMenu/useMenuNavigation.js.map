{"version":3,"file":"useMenuNavigation.js","names":["useEffect","useLayoutEffect","useRef","useState","usePrevious","useRefs","animateTimeout","useMenuNavigation","props","items","addLevel","deleteLevel","active","getItemSubMenu","level","onEsc","isMobile","activeIndex","setActiveIndex","direction","setDirection","refs","length","containerRef","parentRef","previousFlag","setTimeout","current","focus","onKeyDown","e","stopPropagation","preventDefault","code","Math","max","includes","min","click"],"sources":["../../../../../src/components/ContextMenu/useMenuNavigation.ts"],"sourcesContent":["import React, { useEffect, useLayoutEffect, useRef, useState } from 'react';\n\nimport { Direction } from '##/components/Popover';\nimport { usePrevious } from '##/hooks/usePrevious';\nimport { useRefs } from '##/hooks/useRefs';\nimport { animateTimeout } from '##/mixs/MixPopoverAnimate';\n\nimport { ContextMenuItemDefault, ContextMenuPropGetItemSubMenu } from './types';\n\ntype UseMenuNavigationProps<ITEM = ContextMenuItemDefault> = {\n  items: ITEM[];\n  deleteLevel: () => void;\n  getItemSubMenu: ContextMenuPropGetItemSubMenu<ITEM>;\n  active: boolean;\n  addLevel: (item: ITEM) => void;\n  onEsc?: React.KeyboardEventHandler;\n  level?: number;\n  isMobile?: boolean;\n};\n\nexport const useMenuNavigation = (props: UseMenuNavigationProps) => {\n  const {\n    items,\n    addLevel,\n    deleteLevel,\n    active,\n    getItemSubMenu,\n    level = 0,\n    onEsc,\n    isMobile,\n  } = props;\n\n  const [activeIndex, setActiveIndex] = useState(-1);\n\n  const [direction, setDirection] = useState<Direction | undefined>();\n\n  const refs = useRefs<HTMLDivElement>(items.length);\n\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const parentRef = useRef<HTMLDivElement>(null);\n\n  const previousFlag = usePrevious(active);\n\n  useLayoutEffect(() => {\n    setTimeout(() => containerRef.current?.focus(), animateTimeout * 2);\n  }, []);\n\n  useLayoutEffect(() => {\n    setTimeout(\n      () => {\n        (activeIndex >= 0 ? refs[activeIndex] : parentRef).current?.focus();\n      },\n      previousFlag ? animateTimeout * 2 : 0,\n    );\n    if (active) {\n      setTimeout(\n        () => {\n          containerRef.current?.focus();\n        },\n        isMobile ? animateTimeout : 0,\n      );\n    }\n  }, [active]);\n\n  useEffect(() => {\n    setTimeout(\n      () => {\n        (activeIndex >= 0 ? refs[activeIndex] : parentRef).current?.focus();\n      },\n      isMobile ? animateTimeout : 0,\n    );\n  }, [activeIndex]);\n\n  const onKeyDown = (e: React.KeyboardEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n    const { code } = e;\n\n    if (code === 'ArrowUp') {\n      if (isMobile) {\n        if (activeIndex - 1 < 0) {\n          parentRef && parentRef.current?.focus();\n        }\n      }\n      setActiveIndex(Math.max(activeIndex - 1, isMobile ? -1 : 0));\n    }\n    if (code === 'ArrowRight' && activeIndex >= 0) {\n      if (isMobile) {\n        !!getItemSubMenu(items[activeIndex]) && addLevel(items[activeIndex]);\n        return;\n      }\n      if (direction?.includes('left') && !getItemSubMenu(items[activeIndex])) {\n        deleteLevel();\n      } else {\n        addLevel(items[activeIndex]);\n      }\n    }\n    if (code === 'ArrowDown') {\n      setActiveIndex(Math.min(activeIndex + 1, items.length - 1));\n    }\n    if (code === 'ArrowLeft') {\n      if (direction?.includes('right') || isMobile) {\n        deleteLevel();\n      }\n    }\n    if (code === 'Enter') {\n      if (activeIndex >= 0) {\n        if (getItemSubMenu(items[activeIndex])) {\n          addLevel(items[activeIndex]);\n        } else {\n          refs[activeIndex].current?.click();\n        }\n      } else {\n        parentRef.current?.click();\n      }\n    }\n    if (code === 'Space') {\n      (activeIndex >= 0 ? refs[activeIndex] : parentRef).current?.click();\n    }\n    if (code === 'Escape') {\n      if (level === 0) {\n        onEsc?.(e);\n      } else {\n        deleteLevel();\n      }\n    }\n  };\n\n  return {\n    refs,\n    activeIndex,\n    onKeyDown,\n    setActiveIndex,\n    setDirection,\n    parentRef,\n    containerRef,\n  };\n};\n"],"mappings":"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"}