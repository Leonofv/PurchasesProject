{"version":3,"file":"useCalendarVisible.js","names":["useEffect","useRef","useFlag","useKeysRef","useFlagWithDisabled","initial","disabled","state","setState","off","on","toggle","set","action","useCalendarVisible","params","onDropdownOpen","dropdownOpen","startRef","endRef","calendarVisible","setCalendarVisible","isFirstRender","ArrowHandler","e","preventDefault","keys","ArrowUp","ArrowDown","PageUp","PageDown","Home","End","Enter","Escape","Tab","eventHandler","key","ref","isActive","current"],"sources":["../../../../../src/components/DatePicker/useCalendarVisible.ts"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\n\nimport { Flag, useFlag } from '##/hooks/useFlag';\nimport { KeyHandlers, useKeysRef } from '##/hooks/useKeysRef';\n\ntype UseCalendarVisibleParams = {\n  onDropdownOpen?: (isOpen: boolean) => void;\n  dropdownOpen?: boolean;\n  disabled?: boolean;\n  startRef: React.RefObject<HTMLInputElement>;\n  endRef?: React.RefObject<HTMLInputElement>;\n};\ntype UseFlagReturn = ReturnType<typeof useFlagWithDisabled>;\ntype Return = [UseFlagReturn[0], UseFlagReturn[1]];\n\nconst useFlagWithDisabled = (initial = false, disabled?: boolean): Flag => {\n  const [state, setState] = useFlag(initial);\n\n  useEffect(() => {\n    disabled && setState.off();\n  }, [disabled]);\n\n  return [\n    state,\n    {\n      on: () => {\n        !disabled && setState.on();\n      },\n      off: () => setState.off(),\n      toggle: () => {\n        !disabled && setState.toggle();\n      },\n      set: (action) => {\n        !disabled && setState.set(action);\n      },\n    },\n  ];\n};\n\nexport const useCalendarVisible = (\n  params: UseCalendarVisibleParams,\n): Return => {\n  const { onDropdownOpen, dropdownOpen, disabled, startRef, endRef } = params;\n\n  const [calendarVisible, setCalendarVisible] = useFlagWithDisabled(\n    false,\n    disabled,\n  );\n  const isFirstRender = useRef(true);\n\n  const ArrowHandler = (e: KeyboardEvent) => {\n    e.preventDefault();\n    setCalendarVisible.on();\n  };\n\n  const Escape = () => {\n    setCalendarVisible.off();\n  };\n\n  const Enter = () => {\n    !disabled && setCalendarVisible.on();\n  };\n\n  const Tab = (e: KeyboardEvent) => {\n    if (calendarVisible) {\n      e.preventDefault();\n      setCalendarVisible.off();\n    }\n  };\n\n  const keys: KeyHandlers = {\n    ArrowUp: ArrowHandler,\n    ArrowDown: ArrowHandler,\n    PageUp: ArrowHandler,\n    PageDown: ArrowHandler,\n    Home: ArrowHandler,\n    End: ArrowHandler,\n    Enter,\n    Escape,\n    Tab,\n  };\n\n  const eventHandler = (e: KeyboardEvent) => {\n    const { key } = e;\n    if (key !== 'Tab' && key !== 'Escape') {\n      setCalendarVisible.on();\n    }\n  };\n\n  useKeysRef({ ref: startRef, keys, eventHandler, isActive: !disabled });\n  useKeysRef({ ref: endRef, keys, eventHandler, isActive: !disabled });\n\n  useEffect(() => {\n    return () => {\n      isFirstRender.current = true;\n    };\n  }, []);\n\n  useEffect(() => {\n    if (isFirstRender.current) {\n      isFirstRender.current = false;\n      return;\n    }\n    !disabled && onDropdownOpen?.(calendarVisible);\n  }, [calendarVisible]);\n\n  useEffect(() => {\n    !disabled && setCalendarVisible.set(dropdownOpen ?? false);\n  }, [dropdownOpen]);\n\n  return [calendarVisible, setCalendarVisible];\n};\n"],"mappings":"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"}