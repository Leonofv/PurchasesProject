{"version":3,"file":"DragNDropField.js","names":["React","forwardRef","useRef","useDropzone","usePropsHandler","Text","useForkRef","useMutableRef","cn","isRenderProp","DragNDropFieldContent","DragNDropFieldTooltip","formatAccept","getErrorsList","withdefaultLocale","cnDragNDropField","COMPONENT_NAME","DragNDropField","props","ref","dragNDropFieldRef","accept","maxSize","minSize","multiple","onDropFiles","children","localeProp","locale","disabled","onClick","otherProps","onClickRef","handleDrop","useCallback","acceptedFiles","length","onDrop","fileRejections","getRootProps","getInputProps","isDragActive","rootRef","open","handleRootClick","e","target","current","stopPropagation","rootProps","className","active","content","openFileDialog","errors","useMemo"],"sources":["../../../../../src/components/DragNDropField/DragNDropField.tsx"],"sourcesContent":["import './DragNDropField.css';\n\nimport React, { forwardRef, useRef } from 'react';\nimport { DropzoneOptions, useDropzone } from 'react-dropzone';\n\nimport { usePropsHandler } from '##/components/EventInterceptor/usePropsHandler';\nimport { Text } from '##/components/Text/Text';\nimport { useForkRef } from '##/hooks/useForkRef/useForkRef';\nimport { useMutableRef } from '##/hooks/useMutableRef/useMutableRef';\nimport { cn } from '##/utils/bem';\nimport { isRenderProp } from '##/utils/isRenderProp';\n\nimport { DragNDropFieldContent } from './DragNDropFieldContent/DragNDropFieldContent';\nimport { DragNDropFieldTooltip } from './DragNDropFieldTooltip/DragNDropFieldTooltip';\nimport { formatAccept } from './formatAccept';\nimport { getErrorsList } from './getErrorsList';\nimport { withdefaultLocale } from './locale';\nimport { DragNDropFieldProps } from './types';\n\nconst cnDragNDropField = cn('DragNDropField');\n\nexport const COMPONENT_NAME = 'DragNDropField' as const;\n\nexport const DragNDropField = forwardRef<HTMLDivElement, DragNDropFieldProps>(\n  (props, ref) => {\n    const dragNDropFieldRef = useRef<HTMLDivElement>(null);\n\n    const {\n      accept,\n      maxSize,\n      minSize,\n      multiple = false,\n      onDropFiles,\n      children = DragNDropFieldContent,\n      locale: localeProp,\n      disabled,\n      onClick,\n      ...otherProps\n    } = usePropsHandler(COMPONENT_NAME, props, dragNDropFieldRef);\n\n    const onClickRef = useMutableRef(onClick);\n\n    const locale = withdefaultLocale(localeProp);\n\n    const handleDrop: DropzoneOptions['onDrop'] = React.useCallback(\n      (acceptedFiles: File[]) =>\n        acceptedFiles.length > 0 && onDropFiles(acceptedFiles),\n      [onDropFiles],\n    );\n\n    const {\n      fileRejections,\n      getRootProps,\n      getInputProps,\n      isDragActive,\n      rootRef,\n      open,\n    } = useDropzone({\n      accept: formatAccept(accept),\n      maxSize: maxSize || undefined,\n      minSize: minSize || undefined,\n      onDrop: handleDrop,\n      multiple,\n      disabled,\n    });\n\n    const handleRootClick: React.MouseEventHandler<HTMLDivElement> =\n      React.useCallback((e) => {\n        // Чтобы не открывалось окно выбора файла при клике по внутренним элементам\n        if (e.target !== rootRef.current) {\n          e.stopPropagation();\n        }\n        onClickRef.current?.(e);\n      }, []);\n\n    const rootProps = getRootProps({\n      ...otherProps,\n      className: cnDragNDropField({ active: isDragActive, disabled }, [\n        otherProps.className,\n      ]),\n      onClick: handleRootClick,\n    });\n\n    const content = isRenderProp(children)\n      ? children({\n          accept,\n          maxSize,\n          minSize,\n          multiple,\n          openFileDialog: open,\n          locale,\n          disabled,\n        })\n      : children;\n\n    const errors = React.useMemo(\n      () => getErrorsList(fileRejections, { maxSize, minSize }, locale),\n      [fileRejections],\n    );\n\n    return (\n      <>\n        <div {...rootProps} ref={useForkRef([ref, rootRef, dragNDropFieldRef])}>\n          <input {...getInputProps()} />\n          {isDragActive ? (\n            <Text view=\"secondary\" size=\"s\" align=\"center\" lineHeight=\"m\">\n              Перетащите файлы сюда\n            </Text>\n          ) : (\n            content\n          )}\n        </div>\n        <DragNDropFieldTooltip anchorRef={rootRef} errors={errors} />\n      </>\n    );\n  },\n);\n\nexport * from './types';\n"],"mappings":"y2BAAA,6BAEA,MAAOA,MAAP,EAAgBC,UAAhB,CAA4BC,MAA5B,KAA0C,OAA1C,CACA,OAA0BC,WAA1B,KAA6C,gBAA7C,CAEA,OAASC,eAAT,2CACA,OAASC,IAAT,oBACA,OAASC,UAAT,yCACA,OAASC,aAAT,+CACA,OAASC,EAAT,uBACA,OAASC,YAAT,gCAEA,OAASC,qBAAT,qDACA,OAASC,qBAAT,qDACA,OAASC,YAAT,sBACA,OAASC,aAAT,uBACA,OAASC,iBAAT,gBAGA,GAAMC,iBAAgB,CAAGP,EAAE,CAAC,gBAAD,CAA3B,CAEA,MAAO,IAAMQ,eAAc,CAAG,gBAAvB,CAEP,MAAO,IAAMC,eAAc,CAAGhB,UAAU,CACtC,SAACiB,CAAD,CAAQC,CAAR,CAAgB,IACRC,EAAiB,CAAGlB,MAAM,CAAiB,IAAjB,CADlB,GAcVE,eAAe,CAACY,cAAD,CAAiBE,CAAjB,CAAwBE,CAAxB,CAdL,CAIZC,CAJY,GAIZA,MAJY,CAKZC,CALY,GAKZA,OALY,CAMZC,CANY,GAMZA,OANY,KAOZC,QAPY,CAOZA,CAPY,eAQZC,CARY,GAQZA,WARY,KASZC,QATY,CASZA,CATY,YASDhB,qBATC,GAUJiB,CAVI,GAUZC,MAVY,CAWZC,CAXY,GAWZA,QAXY,CAYZC,CAZY,GAYZA,OAZY,CAaTC,CAbS,uCAgBRC,CAAU,CAAGzB,aAAa,CAACuB,CAAD,CAhBlB,CAkBRF,CAAM,CAAGd,iBAAiB,CAACa,CAAD,CAlBlB,CAoBRM,CAAqC,CAAGjC,KAAK,CAACkC,WAAN,CAC5C,SAACC,CAAD,QACyB,EAAvB,CAAAA,CAAa,CAACC,MAAd,EAA4BX,CAAW,CAACU,CAAD,CADzC,CAD4C,CAG5C,CAACV,CAAD,CAH4C,CApBhC,GAiCVtB,WAAW,CAAC,CACdkB,MAAM,CAAET,YAAY,CAACS,CAAD,CADN,CAEdC,OAAO,CAAEA,CAAO,QAFF,CAGdC,OAAO,CAAEA,CAAO,QAHF,CAIdc,MAAM,CAAEJ,CAJM,CAKdT,QAAQ,CAARA,CALc,CAMdK,QAAQ,CAARA,CANc,CAAD,CAjCD,CA2BZS,CA3BY,GA2BZA,cA3BY,CA4BZC,CA5BY,GA4BZA,YA5BY,CA6BZC,CA7BY,GA6BZA,aA7BY,CA8BZC,CA9BY,GA8BZA,YA9BY,CA+BZC,CA/BY,GA+BZA,OA/BY,CAgCZC,CAhCY,GAgCZA,IAhCY,CA0CRC,CAAwD,CAC5D5C,KAAK,CAACkC,WAAN,CAAkB,SAACW,CAAD,CAAO,OAEnBA,CAAC,CAACC,MAAF,GAAaJ,CAAO,CAACK,OAFF,EAGrBF,CAAC,CAACG,eAAF,EAHqB,WAKvBhB,CAAU,CAACe,OALY,qBAKvB,OAAAf,CAAU,CAAWa,CAAX,CACX,CAND,CAMG,EANH,CA3CY,CAmDRI,CAAS,CAAGV,CAAY,gCACzBR,CADyB,MAE5BmB,SAAS,CAAEnC,gBAAgB,CAAC,CAAEoC,MAAM,CAAEV,CAAV,CAAwBZ,QAAQ,CAARA,CAAxB,CAAD,CAAqC,CAC9DE,CAAU,CAACmB,SADmD,CAArC,CAFC,CAK5BpB,OAAO,CAAEc,CALmB,GAnDhB,CA2DRQ,CAAO,CAAG3C,YAAY,CAACiB,CAAD,CAAZ,CACZA,CAAQ,CAAC,CACPL,MAAM,CAANA,CADO,CAEPC,OAAO,CAAPA,CAFO,CAGPC,OAAO,CAAPA,CAHO,CAIPC,QAAQ,CAARA,CAJO,CAKP6B,cAAc,CAAEV,CALT,CAMPf,MAAM,CAANA,CANO,CAOPC,QAAQ,CAARA,CAPO,CAAD,CADI,CAUZH,CArEU,CAuER4B,CAAM,CAAGtD,KAAK,CAACuD,OAAN,CACb,iBAAM1C,cAAa,CAACyB,CAAD,CAAiB,CAAEhB,OAAO,CAAPA,CAAF,CAAWC,OAAO,CAAPA,CAAX,CAAjB,CAAuCK,CAAvC,CAAnB,CADa,CAEb,CAACU,CAAD,CAFa,CAvED,CA4Ed,MACE,yCACE,2CAASW,CAAT,EAAoB,GAAG,CAAE3C,UAAU,CAAC,CAACa,CAAD,CAAMuB,CAAN,CAAetB,CAAf,CAAD,CAAnC,GACE,4BAAWoB,CAAa,EAAxB,CADF,CAEGC,CAAY,CACX,oBAAC,IAAD,EAAM,IAAI,CAAC,WAAX,CAAuB,IAAI,CAAC,GAA5B,CAAgC,KAAK,CAAC,QAAtC,CAA+C,UAAU,CAAC,GAA1D,yHADW,CAKXW,CAPJ,CADF,CAWE,oBAAC,qBAAD,EAAuB,SAAS,CAAEV,CAAlC,CAA2C,MAAM,CAAEY,CAAnD,EAXF,CAcH,CA5FqC,CAAjC,CA+FP"}