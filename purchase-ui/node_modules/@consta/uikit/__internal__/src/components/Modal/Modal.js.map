{"version":3,"file":"Modal.js","names":["React","useEffect","useRef","Transition","PortalWithTheme","usePortalContext","useTheme","useClickOutside","useGlobalKeys","animateTimeout","cnMixPopoverAnimate","cnMixScrollBar","cn","modalPropWidth","modalPropWidthDefault","modalPropPosition","modalPropPositionDefault","cnModal","ContextConsumer","onClickOutside","children","ignoreClicksInsideRefs","refs","isActive","handler","Modal","props","isOpen","onClose","onOpen","hasOverlay","onOverlayClick","onEsc","className","width","position","container","window","document","body","refsForExcludeClickOutside","rootClassName","afterClose","style","otherProps","ref","portalRef","theme","Escape","e","animate","zIndex"],"sources":["../../../../../src/components/Modal/Modal.tsx"],"sourcesContent":["import './Modal.css';\n\nimport React, { useEffect, useRef } from 'react';\nimport { Transition } from 'react-transition-group';\n\nimport {\n  PortalWithTheme,\n  usePortalContext,\n} from '##/components/PortalWithTheme';\nimport { useTheme } from '##/components/Theme/Theme';\nimport { useClickOutside } from '##/hooks/useClickOutside';\nimport { useGlobalKeys } from '##/hooks/useGlobalKeys';\nimport { animateTimeout, cnMixPopoverAnimate } from '##/mixs/MixPopoverAnimate';\nimport { cnMixScrollBar } from '##/mixs/MixScrollBar';\nimport { cn } from '##/utils/bem';\nimport { PropsWithHTMLAttributes } from '##/utils/types/PropsWithHTMLAttributes';\n\nconst modalPropWidth = ['auto'] as const;\ntype ModalPropWidth = typeof modalPropWidth[number];\nconst modalPropWidthDefault: ModalPropWidth = modalPropWidth[0];\n\nconst modalPropPosition = ['center', 'top'] as const;\ntype ModalPropPosition = typeof modalPropPosition[number];\nconst modalPropPositionDefault: ModalPropPosition = modalPropPosition[0];\n\ntype ModalProps = PropsWithHTMLAttributes<\n  {\n    isOpen?: boolean;\n    onClose?: () => void;\n    onOpen?: () => void;\n    hasOverlay?: boolean;\n    /** @deprecated use onClickOutside */\n    onOverlayClick?: (event: MouseEvent) => void;\n    onClickOutside?: (event: MouseEvent) => void;\n    onEsc?: (event: KeyboardEvent) => void;\n    rootClassName?: string;\n    width?: ModalPropWidth;\n    position?: ModalPropPosition;\n    children?: React.ReactNode;\n    container?: HTMLDivElement | undefined;\n    afterClose?: () => void;\n    refsForExcludeClickOutside?: React.RefObject<HTMLElement>[];\n  },\n  HTMLDivElement\n>;\n\nconst cnModal = cn('Modal');\n\n/**\n * Подписчик на PortalWithThemeProvider\n * получает рефы всех вложенных порталов в модалку\n * для дальнейшего исключения их из useClickOutside\n */\nconst ContextConsumer: React.FC<{\n  onClickOutside?: (event: MouseEvent) => void;\n  ignoreClicksInsideRefs?: ReadonlyArray<React.RefObject<HTMLElement>>;\n  children: React.ReactNode;\n}> = ({ onClickOutside, children, ignoreClicksInsideRefs }) => {\n  const { refs } = usePortalContext();\n\n  useClickOutside({\n    isActive: !!onClickOutside,\n    ignoreClicksInsideRefs: [\n      ...(ignoreClicksInsideRefs || []),\n      ...(refs || []),\n    ],\n    handler: onClickOutside,\n  });\n\n  return children as React.ReactElement;\n};\n\nexport const Modal: React.FC<ModalProps> = (props) => {\n  const {\n    isOpen,\n    onClose,\n    onOpen,\n    hasOverlay = true,\n    onOverlayClick,\n    onClickOutside,\n    onEsc,\n    className,\n    width = modalPropWidthDefault,\n    position = modalPropPositionDefault,\n    children,\n    container = window.document.body,\n    refsForExcludeClickOutside,\n    rootClassName,\n    afterClose,\n    style,\n    ...otherProps\n  } = props;\n\n  const ref = useRef<HTMLDivElement | null>(null);\n  const portalRef = useRef<HTMLDivElement | null>(null);\n  const { theme } = useTheme();\n\n  useEffect(() => {\n    if (isOpen) {\n      onOpen?.();\n    } else {\n      onClose?.();\n    }\n  }, [isOpen]);\n\n  useGlobalKeys({\n    Escape: (e: KeyboardEvent) => isOpen && onEsc && onEsc(e),\n  });\n\n  return (\n    <Transition\n      in={isOpen}\n      unmountOnExit\n      nodeRef={portalRef}\n      timeout={animateTimeout}\n      onExited={afterClose}\n    >\n      {(animate) => (\n        <PortalWithTheme\n          preset={theme}\n          container={container}\n          className={cnModal({ hasOverlay }, [rootClassName])}\n          ref={portalRef}\n          style={\n            typeof style?.zIndex === 'number'\n              ? { zIndex: style.zIndex }\n              : undefined\n          }\n        >\n          {hasOverlay && (\n            <div\n              className={cnModal('Overlay', { animate })}\n              aria-label=\"Overlay\"\n            />\n          )}\n          <div\n            {...otherProps}\n            style={{\n              ...style,\n              zIndex: undefined,\n            }}\n            className={cnModal('Window', { width, position }, [\n              cnMixPopoverAnimate({ animate }),\n              className,\n              cnMixScrollBar(),\n            ])}\n            ref={ref}\n          >\n            <ContextConsumer\n              onClickOutside={onClickOutside || onOverlayClick}\n              ignoreClicksInsideRefs={[\n                ...(refsForExcludeClickOutside || []),\n                ref,\n              ]}\n            >\n              {children}\n            </ContextConsumer>\n          </div>\n        </PortalWithTheme>\n      )}\n    </Transition>\n  );\n};\n"],"mappings":"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"}