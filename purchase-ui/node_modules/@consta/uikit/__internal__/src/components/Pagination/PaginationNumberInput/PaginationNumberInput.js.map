{"version":3,"file":"PaginationNumberInput.js","names":["React","forwardRef","useCallback","useEffect","useMemo","useIMask","Text","TextField","useMutableRef","cnMixFlex","cn","isNotNil","paginationPropFormDefault","paginationPropSizeDefault","cnPaginationNumberInput","defaultGetTotalLabel","pages","PaginationNumberInput","props","ref","value","onChange","total","getTotalLabel","size","form","className","otherProps","mask","Number","scale","min","max","inputRef","stringValue","setStringValue","setValue","onChangeRef","stringValueRef","setStringValueRef","keysMap","ArrowUp","e","preventDefault","Math","current","toString","ArrowDown","Enter","nativeEvent","handleKeyDown","stopPropagation","key","newValue","align","justify","gap"],"sources":["../../../../../../src/components/Pagination/PaginationNumberInput/PaginationNumberInput.tsx"],"sourcesContent":["import './PaginationNumberInput.css';\n\nimport React, { forwardRef, useCallback, useEffect, useMemo } from 'react';\nimport { ReactMaskOpts, useIMask } from 'react-imask';\n\nimport { Text } from '##/components/Text';\nimport { TextField } from '##/components/TextField';\nimport { useMutableRef } from '##/hooks/useMutableRef';\nimport { cnMixFlex } from '##/mixs/MixFlex';\nimport { cn } from '##/utils/bem';\nimport { isNotNil } from '##/utils/type-guards';\n\nimport {\n  PaginationNumberInputProps,\n  paginationPropFormDefault,\n  paginationPropSizeDefault,\n} from '../types';\n\nconst cnPaginationNumberInput = cn('PaginationNumberInput');\n\nconst defaultGetTotalLabel = (pages: number) => `из ${pages}`;\n\nexport const PaginationNumberInput = forwardRef<\n  HTMLDivElement,\n  PaginationNumberInputProps\n>((props, ref) => {\n  const {\n    value,\n    onChange,\n    total,\n    getTotalLabel = defaultGetTotalLabel,\n    size = paginationPropSizeDefault,\n    form = paginationPropFormDefault,\n    className,\n    ...otherProps\n  } = props;\n\n  const {\n    ref: inputRef,\n    value: stringValue,\n    setValue: setStringValue,\n  } = useIMask<HTMLInputElement, ReactMaskOpts>({\n    mask: Number,\n    scale: 0,\n    min: 1,\n    max: total,\n  });\n\n  const onChangeRef = useMutableRef(onChange);\n  const stringValueRef = useMutableRef(stringValue);\n  const setStringValueRef = useMutableRef(setStringValue);\n\n  const keysMap: Record<string, React.KeyboardEventHandler> = useMemo(() => {\n    return {\n      ArrowUp: (e) => {\n        e.preventDefault();\n        const value = Math.max(\n          Math.min(Number(stringValueRef.current) + 1, total),\n          1,\n        );\n        setStringValueRef.current(value.toString());\n      },\n\n      ArrowDown: (e) => {\n        e.preventDefault();\n        const value = Math.max(\n          Math.min(Number(stringValueRef.current) - 1, total),\n          1,\n        );\n        setStringValueRef.current(value.toString());\n      },\n\n      Enter: (e) => {\n        e.preventDefault();\n        if (Number(stringValueRef.current)) {\n          onChangeRef.current?.(Number(stringValueRef.current), {\n            e: e.nativeEvent,\n          });\n        }\n      },\n    };\n  }, [total]);\n\n  const handleKeyDown: React.KeyboardEventHandler = useCallback(\n    (e) => {\n      e.stopPropagation();\n      keysMap[e.key]?.(e);\n    },\n    [keysMap],\n  );\n\n  useEffect(() => {\n    const newValue = value?.toString() || '';\n    if (newValue !== stringValueRef.current) {\n      setStringValueRef.current(newValue);\n    }\n  }, [value]);\n\n  return (\n    <div\n      {...otherProps}\n      className={cnPaginationNumberInput({ size }, [\n        cnMixFlex({ align: 'center', justify: 'center', gap: 'xs' }),\n        className,\n      ])}\n      ref={ref}\n    >\n      <TextField\n        defaultValue={value ? value.toString() : undefined}\n        size={size}\n        form={form}\n        inputRef={inputRef}\n        onKeyDown={handleKeyDown}\n        className={cnPaginationNumberInput('Input')}\n      />\n      {isNotNil(total) && (\n        <Text className={cnPaginationNumberInput('Total')} size={size}>\n          {getTotalLabel(total)}\n        </Text>\n      )}\n    </div>\n  );\n});\n"],"mappings":"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"}