import _defineProperty from"@babel/runtime/helpers/defineProperty";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";var _excluded=["children","direction","offset","arrowOffset","possibleDirections","isInteractive","onClickOutside","spareDirection","style","className","position","anchorRef","equalAnchorWidth","onSetDirection"];function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}import"./Popover.css";import React,{forwardRef,useEffect,useLayoutEffect,useMemo}from"react";import{PortalWithTheme,usePortalContext}from"../PortalWithTheme";import{useTheme}from"../Theme/Theme";import{useClickOutside}from"../../hooks/useClickOutside";import{useComponentSize}from"../../hooks/useComponentSize";import{useForkRef}from"../../hooks/useForkRef";import{cn}from"../../utils/bem";import{isRenderProp}from"../../utils/isRenderProp";import{isNumber,isString}from"../../utils/type-guards";import{getComputedPositionAndDirection}from"./helpers";import{usePopoverReposition}from"./usePopoverReposition";export var directionsStartCenter=["downCenter","upCenter","downRight","downLeft","upRight","upLeft","leftUp","leftCenter","leftDown","rightUp","rightCenter","rightDown"];export var directionsStartEdge=["downStartLeft","upStartLeft","downStartRight","upStartRight","leftStartUp","leftStartDown","rightStartUp","rightStartDown"];export var popoverPropOffset=["3xs","2xs","xs","s","m","l","xl","2xl","3xl","4xl","5xl","6xl"];export var directions=[].concat(directionsStartCenter,directionsStartEdge);var getOffset=function(a,b){if(isNumber(b))return b;if(isString(b)&&a.current){var g=getComputedStyle(a.current).getPropertyValue("--space-".concat(b));if(g&&/px$/.test(g))return+g.slice(0,g.length-2);if(g&&/rem$/.test(g)){var c=parseFloat(getComputedStyle(document.documentElement).fontSize),d=+g.slice(0,g.length-3);return c*d}if(g&&/em$/.test(g)){var e=parseFloat(getComputedStyle(a.current).fontSize),f=+g.slice(0,g.length-2);return e*f}return 0}return 0},ContextConsumer=function(a){var b=a.onClickOutside,c=a.children,d=a.ignoreClicksInsideRefs,e=usePortalContext(),f=e.refs;return useClickOutside({isActive:!!b,ignoreClicksInsideRefs:[].concat(_toConsumableArray(d||[]),_toConsumableArray(f||[])),handler:b}),c},cnPopover=cn("Popover");export var Popover=forwardRef(function(a,b){var c,d=a.children,e=a.direction,f=void 0===e?"upCenter":e,g=a.offset,h=void 0===g?0:g,i=a.arrowOffset,j=a.possibleDirections,k=void 0===j?directions:j,l=a.isInteractive,m=a.onClickOutside,n=a.spareDirection,o=void 0===n?"downStartLeft":n,p=a.style,q=a.className,r=a.position,s=a.anchorRef,t=a.equalAnchorWidth,u=a.onSetDirection,v=_objectWithoutProperties(a,_excluded),w=React.useRef(null),x=useTheme(),y=x.theme,z=React.useState(),A=_slicedToArray(z,2),B=A[0],C=A[1],D=useComponentSize(w),E=D.width,F=D.height,G=useComponentSize(s||{current:null}),H=React.useRef(null),I=React.useState([]),J=_slicedToArray(I,2),K=J[0],L=J[1],M=function(){L(function(a){return a.length?[]:a}),H.current=null},N=function(){var a;return C(null===s||void 0===s||null===(a=s.current)||void 0===a?void 0:a.getBoundingClientRect())},O=useMemo(function(){return getOffset(w,h)},[h,!!w.current]),P=getComputedPositionAndDirection({contentSize:{width:E,height:F},viewportSize:{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight},arrowOffset:i,offset:O,direction:f,possibleDirections:k,bannedDirections:K,position:B?{x:B.left,y:B.top}:r,anchorSize:G,spareDirection:o}),Q=P.position,R=P.direction;useEffect(function(){return null===u||void 0===u?void 0:u(R)},[R]),useEffect(N,[G]),usePopoverReposition({isActive:!0,scrollAnchorRef:s||{current:null},onRequestReposition:function onRequestReposition(){M(),N()}}),useLayoutEffect(function(){H.current!==R&&(H.current&&!K.includes(H.current)&&!K.includes(R)&&R!==o&&L(function(a){return H.current?[].concat(_toConsumableArray(a),[H.current]):a}),H.current=R)},[R]),useLayoutEffect(M,[a]);var S=!Q||!F||!E;return React.createElement(PortalWithTheme,Object.assign({},v,{preset:y,className:cnPopover({direction:R,notVisible:S},[q]),container:window.document.body,ref:useForkRef([w,b]),style:_objectSpread(_objectSpread({},p),S?{}:(c={},_defineProperty(c,"--popover-top","".concat(((null===Q||void 0===Q?void 0:Q.y)||0)+window.scrollY,"px")),_defineProperty(c,"--popover-left","".concat(((null===Q||void 0===Q?void 0:Q.x)||0)+window.scrollX,"px")),_defineProperty(c,"--popover-width",t?"".concat(G.width,"px"):void 0),_defineProperty(c,"--popover-pointer-events",!(void 0!==l)||l?void 0:"none"),_defineProperty(c,"--popover-visibility",Q?void 0:"hidden"),c))}),React.createElement(ContextConsumer,{onClickOutside:m,ignoreClicksInsideRefs:[w,s||{current:null}]},isRenderProp(d)?d(R):d))});
//# sourceMappingURL=Popover.js.map