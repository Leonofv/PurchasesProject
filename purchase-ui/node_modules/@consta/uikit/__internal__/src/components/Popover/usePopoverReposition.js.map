{"version":3,"file":"usePopoverReposition.js","names":["useEffect","useMutableRef","getAllParents","element","mutableParents","currentNode","push","parentNode","usePopoverReposition","isActive","scrollAnchorRef","onRequestReposition","onRequestRepositionRef","fn","current","window","addEventListener","allParents","forEach","parentEl","removeEventListener"],"sources":["../../../../../src/components/Popover/usePopoverReposition.ts"],"sourcesContent":["import React, { useEffect } from 'react';\n\nimport { useMutableRef } from '../../hooks/useMutableRef/useMutableRef';\n\nconst getAllParents = (element: HTMLElement): readonly Node[] => {\n  const mutableParents: Node[] = [];\n  let currentNode: Node | null = element;\n\n  while (currentNode) {\n    currentNode !== element && mutableParents.push(currentNode);\n    currentNode = currentNode.parentNode;\n  }\n\n  return mutableParents;\n};\n\n/** Запрос репозиции поповера при ресайзе окна и скролле */\nexport const usePopoverReposition = ({\n  isActive,\n  scrollAnchorRef,\n  onRequestReposition,\n}: {\n  isActive: boolean;\n  /** При скролле родителей этого элемента будет запрашиваться репозиция поповера */\n  scrollAnchorRef: React.RefObject<HTMLElement | null>;\n  onRequestReposition: () => void;\n}) => {\n  const onRequestRepositionRef = useMutableRef(onRequestReposition);\n\n  useEffect(() => {\n    const fn = () => onRequestRepositionRef.current();\n    if (isActive) {\n      window.addEventListener('resize', fn);\n\n      const allParents = scrollAnchorRef?.current\n        ? getAllParents(scrollAnchorRef.current)\n        : [];\n      allParents.forEach((parentEl) => parentEl.addEventListener('scroll', fn));\n\n      return () => {\n        window.removeEventListener('resize', fn);\n\n        allParents.forEach((parentEl) =>\n          parentEl.removeEventListener('scroll', fn),\n        );\n      };\n    }\n    return undefined;\n  }, [scrollAnchorRef]);\n};\n"],"mappings":"AAAA,OAAgBA,SAAhB,KAAiC,OAAjC,CAEA,OAASC,aAAT,+CAEA,GAAMC,cAAa,CAAG,SAACC,CAAD,CAA2C,QACzDC,EAAsB,CAAG,EADgC,CAE3DC,CAAwB,CAAGF,CAFgC,CAIxDE,CAJwD,EAK7DA,CAAW,GAAKF,CAAhB,EAA2BC,CAAc,CAACE,IAAf,CAAoBD,CAApB,CALkC,CAM7DA,CAAW,CAAGA,CAAW,CAACE,UANmC,CAS/D,MAAOH,EACR,CAVD,CAaA,MAAO,IAAMI,qBAAoB,CAAG,WAS9B,IARJC,EAQI,GARJA,QAQI,CAPJC,CAOI,GAPJA,eAOI,CANJC,CAMI,GANJA,mBAMI,CACEC,CAAsB,CAAGX,aAAa,CAACU,CAAD,CADxC,CAGJX,SAAS,CAAC,UAAM,CACd,GAAMa,EAAE,CAAG,iBAAMD,EAAsB,CAACE,OAAvB,EAAN,CAAX,CACA,GAAIL,CAAJ,CAAc,CACZM,MAAM,CAACC,gBAAP,CAAwB,QAAxB,CAAkCH,CAAlC,CADY,CAGZ,GAAMI,EAAU,CAAG,OAAAP,CAAe,WAAfA,CAAA,EAAAA,CAAe,CAAEI,OAAjB,CACfZ,aAAa,CAACQ,CAAe,CAACI,OAAjB,CADE,CAEf,EAFJ,CAKA,MAFAG,EAAU,CAACC,OAAX,CAAmB,SAACC,CAAD,QAAcA,EAAQ,CAACH,gBAAT,CAA0B,QAA1B,CAAoCH,CAApC,CAAd,CAAnB,CAEA,CAAO,UAAM,CACXE,MAAM,CAACK,mBAAP,CAA2B,QAA3B,CAAqCP,CAArC,CADW,CAGXI,CAAU,CAACC,OAAX,CAAmB,SAACC,CAAD,QACjBA,EAAQ,CAACC,mBAAT,CAA6B,QAA7B,CAAuCP,CAAvC,CADiB,CAAnB,CAGD,CACF,CAEF,CAnBQ,CAmBN,CAACH,CAAD,CAnBM,CAoBV,CAhCM"}