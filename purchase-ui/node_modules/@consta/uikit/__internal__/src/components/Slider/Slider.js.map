{"version":3,"file":"Slider.js","names":["React","forwardRef","useRef","useState","usePropsHandler","FieldCaption","FieldLabel","useFlag","useForkRef","useSortSteps","cn","defaultTooltipFormatter","getIcon","getMaxForStartField","getMinForEndField","getOnChandgeForInput","getValidStep","getValueForInput","isRangeParams","sliderPropSizeDefault","SliderInput","SliderLine","SliderPoint","useSlider","useSliderStationing","cnSlider","sizeMap","xs","s","m","l","COMPONENT_NAME","SliderRender","props","ref","sliderRef","min","max","onChange","onAfterChange","value","stepProp","step","disabled","size","view","leftSide","rightSide","withTooltip","range","label","tooltipDirection","tooltipPossibleDirections","labelIcon","status","caption","tooltipFormatter","className","style","otherProps","focusIndex","setFocusIndex","isHovered","on","off","containerRef","leftButtonRef","rightButtonRef","sortedSteps","Math","abs","IconRight","IconLeft","iconSize","buttonRefs","onKeyPress","onFocus","handlePress","onSliderClick","popoverPosition","activeButton","currentValue","length","lineSizes","buttonPositions","containerProps","role","tabIndex","onClick","changeHovered","position","map","val","index","topLayer","zIndex","Slider"],"sources":["../../../../../src/components/Slider/Slider.tsx"],"sourcesContent":["import './Slider.css';\n\nimport { IconPropSize } from '@consta/icons/Icon';\nimport React, { forwardRef, useRef, useState } from 'react';\n\nimport { usePropsHandler } from '##/components/EventInterceptor/usePropsHandler';\nimport { FieldCaption } from '##/components/FieldCaption';\nimport { FieldLabel } from '##/components/FieldLabel';\nimport { useFlag } from '##/hooks/useFlag';\nimport { useForkRef } from '##/hooks/useForkRef';\nimport { useSortSteps } from '##/hooks/useSortSteps';\nimport { cn } from '##/utils/bem';\n\nimport {\n  defaultTooltipFormatter,\n  getIcon,\n  getMaxForStartField,\n  getMinForEndField,\n  getOnChandgeForInput,\n  getValidStep,\n  getValueForInput,\n  isRangeParams,\n  SliderComponent,\n  SliderProps,\n  SliderPropSize,\n  sliderPropSizeDefault,\n} from './helper';\nimport { SliderInput } from './SliderInput/SliderInput';\nimport { SliderLine } from './SliderLine/SliderLine';\nimport { SliderPoint } from './SliderPoint/SliderPoint';\nimport { ActiveButton } from './useSlider/helper';\nimport { useSlider } from './useSlider/useSlider';\nimport { useSliderStationing } from './useSliderStationing';\n\nconst cnSlider = cn('Slider');\n\nconst sizeMap: Record<SliderPropSize, IconPropSize> = {\n  xs: 'xs',\n  s: 's',\n  m: 'm',\n  l: 'm',\n};\n\nexport const COMPONENT_NAME = 'Slider' as const;\n\nconst SliderRender = <RANGE extends boolean = false>(\n  props: SliderProps<RANGE>,\n  ref: React.Ref<HTMLDivElement>,\n) => {\n  const sliderRef = useRef<HTMLDivElement>(null);\n\n  const {\n    min = 0,\n    max = 100,\n    onChange,\n    onAfterChange,\n    value,\n    step: stepProp,\n    disabled = false,\n    size = sliderPropSizeDefault,\n    view = 'default',\n    leftSide,\n    rightSide,\n    withTooltip,\n    range = false,\n    label,\n    tooltipDirection,\n    tooltipPossibleDirections,\n    labelIcon,\n    status,\n    caption,\n    tooltipFormatter = defaultTooltipFormatter,\n    className,\n    style,\n    ...otherProps\n  } = usePropsHandler(COMPONENT_NAME, props, sliderRef);\n\n  const [focusIndex, setFocusIndex] = useState<number | undefined>();\n  const [isHovered, { on, off }] = useFlag(false);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const leftButtonRef = useRef<HTMLButtonElement>(null);\n  const rightButtonRef = useRef<HTMLButtonElement>(null);\n  const sortedSteps = useSortSteps({\n    step: getValidStep(min, max, stepProp),\n    min,\n    max,\n  });\n  const step = stepProp ? sortedSteps : Math.abs((max - min) / 100);\n  const IconRight = getIcon(rightSide);\n  const IconLeft = getIcon(leftSide);\n  const iconSize = sizeMap[size];\n\n  const {\n    onKeyPress,\n    onFocus,\n    handlePress,\n    onSliderClick,\n    popoverPosition,\n    activeButton,\n    currentValue,\n  } = useSlider({\n    disabled,\n    range,\n    value,\n    min,\n    max,\n    step,\n    onChange,\n    onAfterChange,\n    sliderRef,\n    containerRef,\n    buttonRefs: [leftButtonRef, rightButtonRef],\n  });\n\n  const { lineSizes, buttonPositions } = useSliderStationing(\n    currentValue.length === 1 ? currentValue[0] : currentValue,\n    min,\n    max,\n    view,\n    range,\n    step,\n    [leftButtonRef, rightButtonRef],\n    sliderRef,\n  );\n\n  const containerProps = {\n    role: 'button',\n    tabIndex: 0,\n    className: cnSlider('Control'),\n    ref: sliderRef,\n    onClick: onSliderClick,\n  };\n\n  const changeHovered = (status: boolean) => {\n    if (status) on();\n    else off();\n  };\n\n  return (\n    <div\n      ref={useForkRef([ref, containerRef])}\n      className={cnSlider({ size }, [className])}\n      style={style}\n      {...otherProps}\n    >\n      {label && (\n        <FieldLabel icon={labelIcon} className={cnSlider('Label')} size={size}>\n          {label}\n        </FieldLabel>\n      )}\n      <div className={cnSlider('Container')}>\n        {(leftSide === 'input' || IconLeft) && (\n          <div className={cnSlider('Side', { position: 'left' })}>\n            {leftSide === 'input' && (\n              <SliderInput\n                value={getValueForInput(props, 0)}\n                onFocus={() => setFocusIndex(0)}\n                onBlur={() => setFocusIndex(undefined)}\n                onChange={getOnChandgeForInput(props, 0)}\n                size={size}\n                min={min}\n                inputMode=\"numeric\"\n                max={getMaxForStartField(props)}\n                status={status}\n                step={step}\n                disabled={disabled}\n              />\n            )}\n            {IconLeft && (\n              <IconLeft size={iconSize ?? undefined} view=\"secondary\" />\n            )}\n          </div>\n        )}\n        <div {...containerProps}>\n          <SliderLine\n            hovered={isHovered || typeof activeButton === 'number'}\n            onHover={changeHovered}\n            lines={lineSizes}\n            disabled={disabled}\n            view={view}\n          />\n          {currentValue.map((val, index) => {\n            const topLayer =\n              currentValue.length > 1 &&\n              currentValue[0] === currentValue[1] &&\n              val === max &&\n              index === 0;\n            return (\n              <SliderPoint\n                hovered={isHovered || typeof activeButton === 'number'}\n                buttonRef={leftButtonRef}\n                popoverPosition={popoverPosition[index]}\n                onKeyPress={onKeyPress}\n                onFocus={onFocus}\n                tooltipDirection={tooltipDirection}\n                tooltipPossibleDirections={tooltipPossibleDirections}\n                handlePress={handlePress}\n                disabled={disabled}\n                active={topLayer}\n                position={buttonPositions[index]}\n                focused={activeButton === index || focusIndex === index}\n                buttonLabel={index as ActiveButton}\n                withTooltip={withTooltip}\n                onHover={changeHovered}\n                tooltipFormatter={tooltipFormatter}\n                value={val}\n                role=\"slider\"\n                aria-valuemin={min}\n                aria-valuemax={max}\n                aria-valuenow={val}\n                tooltipZIndex={\n                  typeof style?.zIndex === 'number'\n                    ? style.zIndex + 1\n                    : undefined\n                }\n                key={cnSlider('Point', { index })}\n              />\n            );\n          })}\n        </div>\n        {(rightSide === 'input' || IconRight) && (\n          <div className={cnSlider('Side', { position: 'right' })}>\n            {rightSide === 'input' && (\n              <SliderInput\n                value={getValueForInput(props, 1)}\n                onChange={getOnChandgeForInput(props, 1)}\n                onBlur={() => setFocusIndex(undefined)}\n                size={size}\n                min={getMinForEndField(props)}\n                max={max}\n                onFocus={() => setFocusIndex(isRangeParams(props) ? 1 : 0)}\n                inputMode=\"numeric\"\n                status={status}\n                step={step}\n                disabled={disabled}\n              />\n            )}\n            {IconRight && <IconRight size={iconSize} view=\"secondary\" />}\n          </div>\n        )}\n      </div>\n      {caption && (\n        <FieldCaption className={cnSlider('Caption')} status={status}>\n          {caption}\n        </FieldCaption>\n      )}\n    </div>\n  );\n};\n\nexport const Slider = forwardRef(SliderRender) as SliderComponent;\n"],"mappings":"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"}