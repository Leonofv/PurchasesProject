{"version":3,"file":"SliderPoint.js","names":["React","useEffect","useRef","generateThemeClassNames","ThemeContext","useTheme","Tooltip","useFlag","useForkRef","cnMixFocus","cn","cnSliderPoint","getTooltipPosition","popoverPosition","buttonRef","current","getBoundingClientRect","y","height","x","Math","round","defaultPossibleDirections","SliderPoint","props","hovered","onHover","value","position","disabled","withTooltip","focused","active","handlePress","onKeyPress","tooltipFormatter","buttonLabel","onFocus","tooltipDirection","tooltipPossibleDirections","tooltipZIndex","otherProps","tooltipVisible","setTooltipVisible","theme","tooltipTheme","color","primary","invert","accent","tooltipThemeClassNames","handleFocus","e","on","handleMouseAction","enter","off","pointRef","tooltipPosition","handleBlur","themeClassNames","zIndex"],"sources":["../../../../../../src/components/Slider/SliderPoint/SliderPoint.tsx"],"sourcesContent":["import './SliderPoint.css';\n\nimport React, { useEffect, useRef } from 'react';\n\nimport { Direction } from '##/components/Popover';\nimport {\n  generateThemeClassNames,\n  ThemeContext,\n  useTheme,\n} from '##/components/Theme';\nimport { Tooltip } from '##/components/Tooltip';\nimport { useFlag } from '##/hooks/useFlag/useFlag';\nimport { useForkRef } from '##/hooks/useForkRef/useForkRef';\nimport { cnMixFocus } from '##/mixs/MixFocus/MixFocus';\nimport { cn } from '##/utils/bem';\n\nimport { SliderPointProps, TrackPosition } from '../helper';\n\nconst cnSliderPoint = cn('SliderPoint');\n\nconst getTooltipPosition = (\n  popoverPosition?: TrackPosition,\n  buttonRef?: React.RefObject<HTMLButtonElement>,\n) => {\n  if (popoverPosition && buttonRef && buttonRef.current) {\n    const { y, height } = buttonRef.current.getBoundingClientRect();\n    return {\n      x: Math.round(popoverPosition.x),\n      y: Math.round(y + height / 2),\n    };\n  }\n\n  return { x: 0, y: 0 };\n};\n\nconst defaultPossibleDirections: Direction[] = [\n  'leftCenter',\n  'rightCenter',\n  'downCenter',\n  'leftDown',\n  'rightDown',\n  'upCenter',\n];\n\nexport const SliderPoint = (props: SliderPointProps) => {\n  const {\n    hovered,\n    onHover,\n    value,\n    position,\n    disabled,\n    withTooltip,\n    focused,\n    popoverPosition,\n    buttonRef,\n    active,\n    handlePress,\n    onKeyPress,\n    tooltipFormatter,\n    buttonLabel,\n    onFocus,\n    tooltipDirection = 'downCenter',\n    tooltipPossibleDirections = defaultPossibleDirections,\n    tooltipZIndex,\n    ...otherProps\n  } = props;\n\n  const [tooltipVisible, setTooltipVisible] = useFlag(false);\n\n  const { theme } = useTheme();\n\n  const tooltipTheme = {\n    ...theme,\n    color: {\n      primary: theme.color.invert,\n      accent: theme.color.accent,\n      invert: theme.color.primary,\n    },\n  };\n\n  const tooltipThemeClassNames = generateThemeClassNames(tooltipTheme);\n\n  const handleFocus = (\n    e: React.FocusEvent<HTMLButtonElement> | React.MouseEvent,\n  ) => {\n    if (!disabled) {\n      onFocus?.(e, buttonLabel);\n      setTooltipVisible.on();\n    }\n  };\n\n  const handleMouseAction = (enter: boolean) => {\n    if (!disabled) {\n      onHover?.(enter);\n      enter && setTooltipVisible.on();\n      if (enter) setTooltipVisible.on();\n      if (!enter && !focused) setTooltipVisible.off();\n    }\n  };\n\n  const handleBlur = (\n    e:\n      | React.FocusEvent<HTMLButtonElement>\n      | React.MouseEvent<HTMLButtonElement>,\n  ) => {\n    if (!disabled) {\n      onFocus?.(e, null);\n      setTooltipVisible.off();\n    }\n  };\n\n  const pointRef = useRef<HTMLButtonElement>(null);\n\n  const tooltipPosition = getTooltipPosition(\n    popoverPosition,\n    buttonRef || pointRef,\n  );\n\n  useEffect(() => {\n    focused ? setTooltipVisible.on() : setTooltipVisible.off();\n  }, [focused]);\n\n  const tooltipOpen = !!(tooltipVisible && withTooltip && popoverPosition);\n\n  return (\n    <>\n      <button\n        type=\"button\"\n        aria-label={`${buttonLabel}-button`}\n        className={cnSliderPoint({ hovered, disabled, active }, [\n          !disabled ? cnMixFocus() : '',\n        ])}\n        onMouseOver={() => handleMouseAction(true)}\n        onMouseOut={() => handleMouseAction(false)}\n        onMouseDown={() => handlePress?.(buttonLabel)}\n        onTouchStart={() => handlePress?.(buttonLabel)}\n        onKeyDown={(e) => onKeyPress?.(e, buttonLabel)}\n        onFocus={handleFocus}\n        onBlur={handleBlur}\n        onClick={handleFocus}\n        ref={useForkRef([buttonRef, pointRef])}\n        tabIndex={0}\n        style={{\n          ['--slider-button-left' as string]: `${position}%`,\n        }}\n        {...otherProps}\n      />\n\n      <ThemeContext.Provider\n        // eslint-disable-next-line react/jsx-no-constructed-context-values\n        value={{\n          theme: tooltipTheme,\n          themeClassNames: tooltipThemeClassNames,\n        }}\n      >\n        <Tooltip\n          isOpen={tooltipOpen}\n          position={tooltipPosition}\n          className={cnSliderPoint('Tooltip')}\n          direction={tooltipDirection}\n          possibleDirections={tooltipPossibleDirections}\n          style={{ zIndex: tooltipZIndex }}\n          offset={10}\n        >\n          {tooltipFormatter ? tooltipFormatter(value) : value}\n        </Tooltip>\n      </ThemeContext.Provider>\n    </>\n  );\n};\n"],"mappings":"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"}