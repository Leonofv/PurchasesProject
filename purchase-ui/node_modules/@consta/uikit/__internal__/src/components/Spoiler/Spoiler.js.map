{"version":3,"file":"Spoiler.js","names":["React","forwardRef","useCallback","useEffect","Text","getElementSize","useFlag","useForkRef","useMutableRef","useRefs","useResizeObserved","cnMixSpace","cn","SpoilerButton","defaultSpoilerPropButtonAlign","defaultSpoilerPropSize","cnSpoiler","spoilerOffsetMap","xs","s","m","l","getContent","children","content","preview","lineClamp","Spoiler","props","ref","maxHeight","size","lessIcon","lessLabel","moreIcon","moreLabel","className","buttonIndent","buttonAlign","style","opened","onOpenButtonClick","otherProps","isOpen","setIsOpen","mode","previewContent","fullContent","refs","sizes","visibleMoreButton","height","onOpenButtonClickRef","handleClick","event","toggle","current","set","width","hidden","align","mT"],"sources":["../../../../../src/components/Spoiler/Spoiler.tsx"],"sourcesContent":["import './Spoiler.css';\n\nimport React, { forwardRef, useCallback, useEffect } from 'react';\n\nimport { Text } from '##/components/Text';\nimport { getElementSize } from '##/hooks/useComponentSize';\nimport { useFlag } from '##/hooks/useFlag';\nimport { useForkRef } from '##/hooks/useForkRef';\nimport { useMutableRef } from '##/hooks/useMutableRef';\nimport { useRefs } from '##/hooks/useRefs';\nimport { useResizeObserved } from '##/hooks/useResizeObserved';\nimport { cnMixSpace, Space } from '##/mixs/MixSpace';\nimport { cn } from '##/utils/bem';\n\nimport { SpoilerButton } from './SpoilerButton';\nimport {\n  defaultSpoilerPropButtonAlign,\n  defaultSpoilerPropSize,\n  SpoilerMode,\n  SpoilerProps,\n  SpoilerPropSize,\n} from './types';\n\nexport const cnSpoiler = cn('Spoiler');\n\nconst spoilerOffsetMap: Record<SpoilerPropSize, Space> = {\n  xs: 'xs',\n  s: 's',\n  m: 'm',\n  l: 'm',\n};\n\nconst getContent = (\n  { children, content, preview, lineClamp }: SpoilerProps,\n  isOpen: boolean,\n): [SpoilerMode, React.ReactNode, React.ReactNode] => {\n  if (lineClamp) {\n    return ['lineClamp', children, children];\n  }\n  if (children) {\n    return ['blur', children, children];\n  }\n  return ['toggle', preview, content];\n};\n\nexport const Spoiler = forwardRef<HTMLDivElement, SpoilerProps>(\n  (props, ref) => {\n    const {\n      preview,\n      maxHeight,\n      content,\n      size = defaultSpoilerPropSize,\n      lessIcon,\n      lessLabel,\n      children,\n      moreIcon,\n      moreLabel,\n      className,\n      lineClamp,\n      buttonIndent,\n      buttonAlign = defaultSpoilerPropButtonAlign,\n      style,\n      opened = false,\n      onOpenButtonClick,\n      ...otherProps\n    } = props;\n\n    const [isOpen, setIsOpen] = useFlag(opened);\n    const [mode, previewContent, fullContent] = getContent(props, isOpen);\n    const refs = useRefs<HTMLDivElement>(3);\n    const sizes = useResizeObserved(refs, getElementSize);\n    const visibleMoreButton = sizes[1].height > sizes[0].height;\n    const onOpenButtonClickRef = useMutableRef(onOpenButtonClick);\n\n    const handleClick = useCallback((event: React.MouseEvent): void => {\n      setIsOpen.toggle();\n      onOpenButtonClickRef.current &&\n        onOpenButtonClickRef.current(!isOpen, event);\n    }, []);\n\n    useEffect(() => {\n      setIsOpen.set(opened);\n    }, [opened]);\n\n    return (\n      <div\n        {...otherProps}\n        className={cnSpoiler({ size }, [className])}\n        ref={useForkRef([ref, refs[2]])}\n        style={{\n          ...style,\n          ...(typeof maxHeight === 'number' && {\n            ['--spoiler-content-max-height' as string]: `${maxHeight}px`,\n          }),\n          ...(typeof lineClamp === 'number' && {\n            ['--spoiler-content-line-clamp' as string]: lineClamp,\n          }),\n          ...(typeof sizes[2].width === 'number' && {\n            ['--spoiler-content-width' as string]: `${sizes[2].width}px`,\n          }),\n        }}\n      >\n        <Text\n          ref={refs[0]}\n          className={cnSpoiler('Content', {\n            mode,\n            hidden: isOpen || !visibleMoreButton,\n          })}\n          size={size}\n        >\n          {previewContent}\n        </Text>\n        <Text\n          ref={refs[1]}\n          className={cnSpoiler('Content', {\n            hidden: !isOpen && visibleMoreButton,\n          })}\n          size={size}\n        >\n          {fullContent}\n        </Text>\n        {visibleMoreButton && (\n          <div\n            className={cnSpoiler('ButtonWrapper', { align: buttonAlign }, [\n              cnMixSpace({\n                mT:\n                  typeof buttonIndent === 'undefined'\n                    ? spoilerOffsetMap[size]\n                    : buttonIndent,\n              }),\n            ])}\n          >\n            <SpoilerButton\n              className={cnSpoiler('Button')}\n              lessIcon={lessIcon}\n              lessLabel={lessLabel}\n              moreIcon={moreIcon}\n              moreLabel={moreLabel}\n              onClick={handleClick}\n              open={isOpen}\n              size={size}\n            />\n          </div>\n        )}\n      </div>\n    );\n  },\n);\n"],"mappings":"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"}