{"version":3,"file":"TableTextFilter.js","names":["IconSearchStroked","React","useMemo","useState","cnMixScrollBar","cn","Button","CheckboxGroup","Text","TextField","TableFilterContainer","cnTextFilter","sanitizeRegex","futureRegex","replaceAll","TableTextFilter","items","withSearch","onConfirm","onCancel","filterValue","title","emptySearchText","searchValue","setSearchValue","checkboxGroupValue","setCheckboxGroupValue","filteredItems","filter","name","match","RegExp","isAllSelected","length","isSelected","confirmHandler","setAll","resetHandler","item"],"sources":["../../../../../../src/components/Table/TextFilter/TableTextFilter.tsx"],"sourcesContent":["import './TableTextFilter.css';\n\nimport { IconSearchStroked } from '@consta/icons/IconSearchStroked';\nimport React, { useMemo, useState } from 'react';\n\nimport { cnMixScrollBar } from '##/mixs/MixScrollBar';\n\nimport { cn } from '../../../utils/bem';\nimport { Button } from '../../Button/Button';\nimport { CheckboxGroup } from '../../CheckboxGroup';\nimport { Text } from '../../Text/Text';\nimport { TextField } from '../../TextField/TextField';\nimport { TableFilterContainer } from '../FilterContainer/TableFilterContainer';\nimport { FilterComponentProps } from '../filtering';\n\nconst cnTextFilter = cn('TableTextFilter');\n\ntype Item = {\n  name: string;\n  value: string;\n};\n\ntype TableTextFilterProps = FilterComponentProps & {\n  items?: Item[];\n  withSearch?: boolean;\n  title?: string;\n  emptySearchText?: string;\n};\n\nconst sanitizeRegex = (futureRegex: string): string =>\n  futureRegex\n    .replaceAll(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\n    .replaceAll(/\\$/g, '$$$$');\n\nexport const TableTextFilter: React.FC<TableTextFilterProps> = ({\n  items = [],\n  withSearch = false,\n  onConfirm,\n  onCancel,\n  filterValue,\n  title,\n  emptySearchText = 'Ничего не найдено :(',\n}) => {\n  const [searchValue, setSearchValue] = useState<string | null>(null);\n  const [checkboxGroupValue, setCheckboxGroupValue] = useState<Item[] | null>(\n    (filterValue as Item[]) || items,\n  );\n\n  const confirmHandler = () => {\n    setSearchValue(null);\n    onConfirm(checkboxGroupValue === null ? [] : checkboxGroupValue);\n  };\n\n  const resetHandler = () => {\n    setCheckboxGroupValue(null);\n  };\n\n  const filteredItems = useMemo(() => {\n    if (!searchValue) {\n      return items;\n    }\n\n    return items.filter(({ name }) => {\n      return name.match(new RegExp(sanitizeRegex(searchValue), 'i'));\n    });\n  }, [searchValue, items]);\n\n  const setAll = () => {\n    setCheckboxGroupValue(filteredItems);\n  };\n\n  const isAllSelected = useMemo(\n    () => filteredItems.length === checkboxGroupValue?.length,\n    [filteredItems, checkboxGroupValue],\n  );\n\n  const isSelected = useMemo(\n    () => checkboxGroupValue?.length,\n    [checkboxGroupValue],\n  );\n\n  return (\n    <TableFilterContainer\n      title={title}\n      onCancel={onCancel}\n      onConfirm={confirmHandler}\n    >\n      {withSearch && (\n        <TextField\n          value={searchValue}\n          onChange={setSearchValue}\n          leftSide={IconSearchStroked}\n          size=\"s\"\n          placeholder=\"Найти в списке\"\n          className={cnTextFilter('Searchbar')}\n        />\n      )}\n      <div className={cnTextFilter('Controls')}>\n        <Button\n          size=\"m\"\n          type=\"button\"\n          form=\"brick\"\n          label=\"Выбрать все\"\n          view=\"clear\"\n          onClick={setAll}\n          disabled={!filteredItems.length || isAllSelected}\n        />\n        <Button\n          size=\"m\"\n          form=\"brick\"\n          type=\"button\"\n          label=\"Сбросить\"\n          view=\"clear\"\n          onClick={resetHandler}\n          disabled={!filteredItems.length || !isSelected}\n        />\n      </div>\n      <div className={cnTextFilter('Checkboxes', [cnMixScrollBar()])}>\n        {filteredItems.length ? (\n          <CheckboxGroup\n            items={filteredItems}\n            value={checkboxGroupValue}\n            getItemLabel={(item) => item.name}\n            onChange={setCheckboxGroupValue}\n            name=\"checkboxGroup\"\n          />\n        ) : (\n          <Text lineHeight=\"2xs\" view=\"primary\" size=\"m\">\n            {emptySearchText}\n          </Text>\n        )}\n      </div>\n    </TableFilterContainer>\n  );\n};\n"],"mappings":"iEAAA,8BAEA,OAASA,iBAAT,KAAkC,iCAAlC,CACA,MAAOC,MAAP,EAAgBC,OAAhB,CAAyBC,QAAzB,KAAyC,OAAzC,CAEA,OAASC,cAAT,kCAEA,OAASC,EAAT,0BACA,OAASC,MAAT,2BACA,OAASC,aAAT,2BACA,OAASC,IAAT,uBACA,OAASC,SAAT,iCACA,OAASC,oBAAT,+C,GAGMC,aAAY,CAAGN,EAAE,CAAC,iBAAD,C,CAcjBO,aAAa,CAAG,SAACC,CAAD,QACpBA,EAAW,CACRC,UADH,CACc,qBADd,CACqC,MADrC,EAEGA,UAFH,CAEc,KAFd,CAEqB,MAFrB,CADoB,C,CAKtB,MAAO,IAAMC,gBAA+C,CAAG,WAQzD,SAPJC,KAOI,CAPJA,CAOI,YAPI,EAOJ,OANJC,UAMI,CALJC,CAKI,GALJA,SAKI,CAJJC,CAII,GAJJA,QAII,CAHJC,CAGI,GAHJA,WAGI,CAFJC,CAEI,GAFJA,KAEI,KADJC,eACI,CADJA,CACI,YADc,iGACd,KACkCnB,QAAQ,CAAgB,IAAhB,CAD1C,uBACGoB,CADH,MACgBC,CADhB,QAEgDrB,QAAQ,CACzDiB,CAAD,EAA2BJ,CAD+B,CAFxD,uBAEGS,CAFH,MAEuBC,CAFvB,MAeEC,CAAa,CAAGzB,OAAO,CAAC,UAAM,OAC7BqB,EAD6B,CAK3BP,CAAK,CAACY,MAAN,CAAa,WAAc,IAAXC,EAAW,GAAXA,IAAW,CAChC,MAAOA,EAAI,CAACC,KAAL,CAAW,GAAIC,OAAJ,CAAWnB,aAAa,CAACW,CAAD,CAAxB,CAAuC,GAAvC,CAAX,CACR,CAFM,CAL2B,CAEzBP,CAMV,CAR4B,CAQ1B,CAACO,CAAD,CAAcP,CAAd,CAR0B,CAfzB,CA6BEgB,CAAa,CAAG9B,OAAO,CAC3B,iBAAMyB,EAAa,CAACM,MAAd,WAAyBR,CAAzB,WAAyBA,CAAzB,QAAyBA,CAAkB,CAAEQ,MAA7C,CAAN,CAD2B,CAE3B,CAACN,CAAD,CAAgBF,CAAhB,CAF2B,CA7BzB,CAkCES,CAAU,CAAGhC,OAAO,CACxB,yBAAMuB,CAAN,WAAMA,CAAN,QAAMA,CAAkB,CAAEQ,MAA1B,CADwB,CAExB,CAACR,CAAD,CAFwB,CAlCtB,CAuCJ,MACE,qBAAC,oBAAD,EACE,KAAK,CAAEJ,CADT,CAEE,QAAQ,CAAEF,CAFZ,CAGE,SAAS,CArCU,QAAjBgB,eAAiB,EAAM,CAC3BX,CAAc,CAAC,IAAD,CADa,CAE3BN,CAAS,CAAwB,IAAvB,GAAAO,CAAkB,CAAY,EAAZ,CAAiBA,CAApC,CACV,CA+BC,EAKG,eACC,oBAAC,SAAD,EACE,KAAK,CAAEF,CADT,CAEE,QAAQ,CAAEC,CAFZ,CAGE,QAAQ,CAAExB,iBAHZ,CAIE,IAAI,CAAC,GAJP,CAKE,WAAW,CAAC,4EALd,CAME,SAAS,CAAEW,YAAY,CAAC,WAAD,CANzB,EANJ,CAeE,2BAAK,SAAS,CAAEA,YAAY,CAAC,UAAD,CAA5B,EACE,oBAAC,MAAD,EACE,IAAI,CAAC,GADP,CAEE,IAAI,CAAC,QAFP,CAGE,IAAI,CAAC,OAHP,CAIE,KAAK,CAAC,+DAJR,CAKE,IAAI,CAAC,OALP,CAME,OAAO,CArCA,QAATyB,OAAS,EAAM,CACnBV,CAAqB,CAACC,CAAD,CACtB,CA6BK,CAOE,QAAQ,CAAE,CAACA,CAAa,CAACM,MAAf,EAAyBD,CAPrC,EADF,CAUE,oBAAC,MAAD,EACE,IAAI,CAAC,GADP,CAEE,IAAI,CAAC,OAFP,CAGE,IAAI,CAAC,QAHP,CAIE,KAAK,CAAC,kDAJR,CAKE,IAAI,CAAC,OALP,CAME,OAAO,CA5DM,QAAfK,aAAe,EAAM,CACzBX,CAAqB,CAAC,IAAD,CACtB,CAoDK,CAOE,QAAQ,CAAE,CAACC,CAAa,CAACM,MAAf,EAAyB,CAACC,CAPtC,EAVF,CAfF,CAmCE,2BAAK,SAAS,CAAEvB,YAAY,CAAC,YAAD,CAAe,CAACP,cAAc,EAAf,CAAf,CAA5B,EACGuB,CAAa,CAACM,MAAd,CACC,oBAAC,aAAD,EACE,KAAK,CAAEN,CADT,CAEE,KAAK,CAAEF,CAFT,CAGE,YAAY,CAAE,sBAACa,CAAD,QAAUA,EAAI,CAACT,IAAf,CAHhB,CAIE,QAAQ,CAAEH,CAJZ,CAKE,IAAI,CAAC,eALP,EADD,CASC,oBAAC,IAAD,EAAM,UAAU,CAAC,KAAjB,CAAuB,IAAI,CAAC,SAA5B,CAAsC,IAAI,CAAC,GAA3C,EACGJ,CADH,CAVJ,CAnCF,CAoDH,CApGM"}