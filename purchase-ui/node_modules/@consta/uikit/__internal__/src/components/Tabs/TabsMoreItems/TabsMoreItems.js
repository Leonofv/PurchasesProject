import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import"./TabsMoreItems.css";import{IconMeatball}from"@consta/icons/IconMeatball";import React,{forwardRef,useCallback,useEffect,useRef,useState}from"react";import{Transition}from"react-transition-group";import{Button}from"../../Button";import{ListBox}from"../../ListCanary";import{Popover}from"../../Popover/Popover";import{useFlag}from"../../../hooks/useFlag";import{useForkRef}from"../../../hooks/useForkRef";import{animateTimeout,cnMixPopoverAnimate}from"../../../mixs/MixPopoverAnimate";import{cn}from"../../../utils/bem";var cnTabsMoreItems=cn("TabsMoreItems"),TabsMoreItemsRender=function(a,b){var c=a.items,d=a.renderItem,e=a.getItemLabel,f=a.height,g=a.size,h=a.onChange,i=useFlag(!1),j=_slicedToArray(i,2),k=j[0],l=j[1],m=useRef(null),n=useRef(null),o=useState("downStartLeft"),p=_slicedToArray(o,2),q=p[0],r=p[1],s=useState(-1),t=_slicedToArray(s,2),u=t[0],v=t[1],w=useRef(-1),x=useRef(!1),y=useCallback(function(a){var b=function(){a.stopPropagation(),a.preventDefault()};if("ArrowDown"===a.key||"ArrowUp"===a.key){b();var d=w.current+("ArrowDown"===a.key?1:-1);return void v(Math.min(Math.max(d,0),c.length))}if("Enter"===a.key){if(b(),!x.current)return void l.on();var e=c[w.current];return e&&(null===h||void 0===h?void 0:h(e,{e:a})),void l.off()}"Escape"===a.key&&(b(),l.off())},[c]);return useEffect(function(){0===c.length&&l.off()},[c]),useEffect(function(){w.current=u},[u]),useEffect(function(){x.current=k,k||v(-1)},[k]),React.createElement(React.Fragment,null,React.createElement("div",{ref:useForkRef([b,m]),className:cnTabsMoreItems("Button"),style:{height:f}},React.createElement(Button,{size:"xs",type:"button",view:"ghost",onlyIcon:!0,iconLeft:IconMeatball,onClick:l.toggle,onKeyDown:y})),React.createElement(Transition,{in:k,unmountOnExit:!0,nodeRef:n,timeout:animateTimeout},function(a){return React.createElement(Popover,{anchorRef:m,offset:-1,ref:n,direction:"downStartRight",onClickOutside:l.off,spareDirection:"downStartLeft",className:cnTabsMoreItems("Popover",[cnMixPopoverAnimate({animate:a,direction:q})]),onSetDirection:r,possibleDirections:["downStartRight","downStartLeft","upStartRight","upStartLeft","downCenter","upCenter"]},React.createElement(ListBox,{shadow:!0,border:!0,size:g,form:"default",className:cnTabsMoreItems("Content")},c.map(function(a,b){return React.createElement("div",{key:e(a),className:cnTabsMoreItems("Item",{active:u===b})},d(a,l.off,!0))})))}))};export var TabsMoreItems=forwardRef(TabsMoreItemsRender);
//# sourceMappingURL=TabsMoreItems.js.map