{"version":3,"file":"TabsMoreItems.js","names":["IconMeatball","React","forwardRef","useCallback","useEffect","useRef","useState","Transition","Button","ListBox","Popover","useFlag","useForkRef","animateTimeout","cnMixPopoverAnimate","cn","cnTabsMoreItems","TabsMoreItemsRender","props","ref","items","renderItem","getItemLabel","height","size","onChange","isOpen","setIsOpen","buttonRef","popoverRef","direction","setDirection","highlightIndex","setHighlightIndex","highlightRef","openRef","handleKeyDown","e","preventDefault","stopPropagation","key","value","current","Math","min","max","length","on","off","toggle","animate","map","item","i","active","TabsMoreItems"],"sources":["../../../../../../src/components/Tabs/TabsMoreItems/TabsMoreItems.tsx"],"sourcesContent":["import './TabsMoreItems.css';\n\nimport { IconMeatball } from '@consta/icons/IconMeatball';\nimport React, {\n  forwardRef,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { Transition } from 'react-transition-group';\n\nimport { Button } from '##/components/Button';\nimport { ListBox } from '##/components/ListCanary';\nimport { Direction, Popover } from '##/components/Popover/Popover';\nimport { useFlag } from '##/hooks/useFlag';\nimport { useForkRef } from '##/hooks/useForkRef';\nimport { animateTimeout, cnMixPopoverAnimate } from '##/mixs/MixPopoverAnimate';\nimport { cn } from '##/utils/bem';\n\nimport { TabsMoreItemsComponent, TabsMoreItemsProps } from '../types';\n\nconst cnTabsMoreItems = cn('TabsMoreItems');\n\nconst TabsMoreItemsRender = (\n  props: TabsMoreItemsProps,\n  ref: React.Ref<HTMLDivElement>,\n) => {\n  const { items, renderItem, getItemLabel, height, size, onChange } = props;\n  const [isOpen, setIsOpen] = useFlag(false);\n  const buttonRef = useRef<HTMLDivElement>(null);\n  const popoverRef = useRef<HTMLDivElement>(null);\n  const [direction, setDirection] = useState<Direction>('downStartLeft');\n  const [highlightIndex, setHighlightIndex] = useState(-1);\n\n  const highlightRef: React.MutableRefObject<number> = useRef(-1);\n  const openRef: React.MutableRefObject<boolean> = useRef(false);\n\n  const handleKeyDown: React.KeyboardEventHandler = useCallback(\n    (e) => {\n      const preventDefault = () => {\n        e.stopPropagation();\n        e.preventDefault();\n      };\n\n      if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\n        preventDefault();\n        const value = highlightRef.current + (e.key === 'ArrowDown' ? 1 : -1);\n        setHighlightIndex(Math.min(Math.max(value, 0), items.length));\n        return;\n      }\n      if (e.key === 'Enter') {\n        preventDefault();\n        if (!openRef.current) {\n          setIsOpen.on();\n          return;\n        }\n        const value = items[highlightRef.current];\n        value && onChange?.(value, { e });\n        setIsOpen.off();\n        return;\n      }\n      if (e.key === 'Escape') {\n        preventDefault();\n        setIsOpen.off();\n      }\n    },\n    [items],\n  );\n\n  useEffect(() => {\n    items.length === 0 && setIsOpen.off();\n  }, [items]);\n\n  useEffect(() => {\n    highlightRef.current = highlightIndex;\n  }, [highlightIndex]);\n\n  useEffect(() => {\n    openRef.current = isOpen;\n    if (!isOpen) {\n      setHighlightIndex(-1);\n    }\n  }, [isOpen]);\n\n  return (\n    <>\n      <div\n        ref={useForkRef([ref, buttonRef])}\n        className={cnTabsMoreItems('Button')}\n        style={{ height }}\n      >\n        <Button\n          size=\"xs\"\n          type=\"button\"\n          view=\"ghost\"\n          onlyIcon\n          iconLeft={IconMeatball}\n          onClick={setIsOpen.toggle}\n          onKeyDown={handleKeyDown}\n        />\n      </div>\n      <Transition\n        in={isOpen}\n        unmountOnExit\n        nodeRef={popoverRef}\n        timeout={animateTimeout}\n      >\n        {(animate) => (\n          <Popover\n            anchorRef={buttonRef}\n            offset={-1}\n            ref={popoverRef}\n            direction=\"downStartRight\"\n            onClickOutside={setIsOpen.off}\n            spareDirection=\"downStartLeft\"\n            className={cnTabsMoreItems('Popover', [\n              cnMixPopoverAnimate({ animate, direction }),\n            ])}\n            onSetDirection={setDirection}\n            possibleDirections={[\n              'downStartRight',\n              'downStartLeft',\n              'upStartRight',\n              'upStartLeft',\n              'downCenter',\n              'upCenter',\n            ]}\n          >\n            <ListBox\n              shadow\n              border\n              size={size}\n              form=\"default\"\n              className={cnTabsMoreItems('Content')}\n            >\n              {items.map((item, i) => (\n                <div\n                  key={getItemLabel(item)}\n                  className={cnTabsMoreItems('Item', {\n                    active: highlightIndex === i,\n                  })}\n                >\n                  {renderItem(item, setIsOpen.off, true)}\n                </div>\n              ))}\n            </ListBox>\n          </Popover>\n        )}\n      </Transition>\n    </>\n  );\n};\n\nexport const TabsMoreItems = forwardRef(\n  TabsMoreItemsRender,\n) as TabsMoreItemsComponent;\n"],"mappings":"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"}