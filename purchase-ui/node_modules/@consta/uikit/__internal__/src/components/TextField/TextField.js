import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["className","type","value","defaultValue","onChange","id","name","rows","cols","minRows","maxRows","inputRef","maxLength","disabled","size","view","form","state","status","onBlur","onFocus","autoFocus","placeholder","leftSide","rightSide","autoComplete","withClearButton","incrementButtons","max","min","readOnly","required","step","tabIndex","ariaLabel","label","labelIcon","inputContainerRef","labelPosition","caption","iconSize","focused","onClick","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onClear"];import"./TextField.css";import{IconClear}from"@consta/icons/IconClear";import{IconEye}from"@consta/icons/IconEye";import{IconEyeClose}from"@consta/icons/IconEyeClose";import{IconSelect}from"@consta/icons/IconSelect";import React,{forwardRef,useCallback,useEffect}from"react";import TextAreaAutoSize from"react-textarea-autosize";import{usePropsHandler}from"../EventInterceptor/usePropsHandler";import{FieldCaption}from"../FieldCaption/FieldCaption";import{FieldLabel}from"../FieldLabel/FieldLabel";import{useFlag}from"../../hooks/useFlag/useFlag";import{useForkRef}from"../../hooks/useForkRef/useForkRef";import{useMutableRef}from"../../hooks/useMutableRef/useMutableRef";import{useSortSteps}from"../../hooks/useSortSteps/useSortSteps";import{cn}from"../../utils/bem";import{getByMap}from"../../utils/getByMap";import{isString}from"../../utils/type-guards";import{getIncrementFlag,getTypeForRender,getValueByStep,inputValue,sizeMap}from"./helpers";import{textFieldPropFormDefault,textFieldPropSizeDefault,textFieldPropViewDefault}from"./types";export var COMPONENT_NAME="TextField";export var cnTextField=cn("TextField");export var TextFieldRender=function(a,b){var c,d,e=React.useRef(null),f=React.useRef(null),g=usePropsHandler(COMPONENT_NAME,a,e),h=g.className,i=g.type,j=void 0===i?"text":i,k=g.value,l=g.defaultValue,m=g.onChange,n=g.id,o=g.name,p=g.rows,q=g.cols,r=g.minRows,s=g.maxRows,t=g.inputRef,u=g.maxLength,v=g.disabled,w=g.size,x=void 0===w?textFieldPropSizeDefault:w,y=g.view,z=void 0===y?textFieldPropViewDefault:y,A=g.form,B=void 0===A?textFieldPropFormDefault:A,C=g.state,D=g.status,E=g.onBlur,F=g.onFocus,G=g.autoFocus,H=void 0!==G&&G,I=g.placeholder,J=g.leftSide,K=g.rightSide,L=g.autoComplete,M=g.withClearButton,N=g.incrementButtons,O=g.max,P=g.min,Q=g.readOnly,R=g.required,S=g.step,T=void 0===S?1:S,U=g.tabIndex,V=g.ariaLabel,W=g.label,X=g.labelIcon,Y=g.inputContainerRef,Z=g.labelPosition,$=void 0===Z?"top":Z,_=g.caption,aa=g.iconSize,ba=g.focused,ca=g.onClick,da=g.onKeyDown,ea=g.onKeyDownCapture,fa=g.onKeyPress,ga=g.onKeyPressCapture,ha=g.onKeyUp,ia=g.onKeyUpCapture,ja=g.onClear,ka=_objectWithoutProperties(g,_excluded),la="number"===j&&(void 0===N||N),ma=useFlag(H),na=_slicedToArray(ma,2),oa=na[0],pa=na[1],qa=useFlag(),ra=_slicedToArray(qa,2),sa=ra[0],ta=ra[1],ua=useFlag(),va=_slicedToArray(ua,2),wa=va[0],xa=va[1],ya=useMutableRef(ca),za=useMutableRef(m),Aa=useCallback(function(a){var b;a.stopPropagation(),ta.toggle(),null===(b=f.current)||void 0===b?void 0:b.focus()},[]),Ba=J,Ca=K,Da=isString(J),Ea=isString(K),Fa=getByMap(sizeMap,x,aa),Ga=useSortSteps({step:T,min:+P,max:+O}),Ha=useCallback(function(a){var b;v||(null===(b=za.current)||void 0===b?void 0:b.call(za,a.target.value||null,{e:a,id:n,name:o})),a.target.value?xa.on():xa.off()},[n,o,v]),Ia=function(a){pa.on(),null===F||void 0===F?void 0:F(a)},Ja={className:cnTextField("Input"),value:inputValue(k),defaultValue:inputValue(l),onChange:Ha,maxLength:u,disabled:v,onBlur:function handleBlur(a){pa.off(),null===E||void 0===E?void 0:E(a)},onFocus:Ia,autoFocus:H,placeholder:I,autoComplete:L,readOnly:Q,tabIndex:U,name:o,onKeyDownCapture:ea,onKeyPress:fa,onKeyPressCapture:ga,onKeyUp:ha,onKeyUpCapture:ia,id:n?n.toString():void 0,"aria-label":V},Ka=sa?IconEyeClose:IconEye,La={rows:p,cols:q,minRows:r||p,maxRows:s||p,ref:useForkRef([f,t])},Ma={type:getTypeForRender(j,sa),max:O,min:P,step:Array.isArray(Ga)?0:Ga,onKeyDown:function onKeyDown(a){var b=getIncrementFlag(a);if(null===da||void 0===da?void 0:da(a),"number"===j&&"boolean"==typeof b&&!v){var c,d;a.preventDefault();var e=getValueByStep(Ga,null===(c=f.current)||void 0===c?void 0:c.value,b,P,O);null===(d=za.current)||void 0===d?void 0:d.call(za,e,{e:a,id:n,name:o}),f.current&&(f.current.value=e,xa.on())}},ref:useForkRef([f,t])},Na=useCallback(function(a){var b;null===(b=za.current)||void 0===b?void 0:b.call(za,null,{e:a,id:n,name:o}),f.current&&(f.current.value="",xa.off())},[]),Oa=function(a){var b,c,d=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],e=getValueByStep(Ga,null===(b=f.current)||void 0===b?void 0:b.value,d,P,O);null===(c=za.current)||void 0===c?void 0:c.call(za,e,{e:a,id:n,name:o}),f.current&&(f.current.value=e,xa.on())},Pa={onClick:useCallback(function(a){var b,c;null===(b=f.current)||void 0===b?void 0:b.focus(),null===(c=ya.current)||void 0===c?void 0:c.call(ya,a)},[])};return useEffect(function(){var a;xa[null!==(a=f.current)&&void 0!==a&&a.value?"on":"off"]()},[null===(c=f.current)||void 0===c?void 0:c.value]),React.createElement("div",Object.assign({className:cnTextField({labelPosition:$,size:x,view:z},[h]),ref:useForkRef([b,e])},Pa,ka),W&&React.createElement(FieldLabel,{as:"label",htmlFor:null===n||void 0===n?void 0:n.toString(),icon:X,required:R,className:cnTextField("Label",{labelPosition:$}),size:x},W),React.createElement("div",{className:cnTextField("Body")},React.createElement("div",{ref:Y,className:cnTextField("InputContainer",{view:z,form:B,status:D||C,disabled:v,type:j,focus:oa||ba,withValue:wa,incrementButtons:"number"===j&&la})},Ba&&React.createElement("div",{className:cnTextField("Side",{position:"left",type:Da?"string":"icon"}),title:"string"==typeof J?J:void 0},Da?J:React.createElement(Ba,{className:cnTextField("Icon"),size:Fa})),"textarea"===j?React.createElement(TextAreaAutoSize,Object.assign({},Ja,La)):React.createElement("input",Object.assign({},Ja,Ma)),la&&!v&&React.createElement("div",{className:cnTextField("Counter")},React.createElement("button",{className:cnTextField("CounterButton",{fn:"increment"}),onFocus:Ia,onClick:function(a){return Oa(a,!0)},type:"button"},React.createElement(IconSelect,{size:"xs"})),React.createElement("button",{className:cnTextField("CounterButton"),onFocus:Ia,onClick:function(a){return Oa(a,!1)},type:"button"},React.createElement(IconSelect,{size:"xs"}))),!la&&wa&&M&&!v&&React.createElement("button",{type:"button",disabled:v,tabIndex:-1,onClick:ja||Na,className:cnTextField("ClearButton")},React.createElement(IconClear,{size:sizeMap[x],className:cnTextField("ClearButtonIcon")})),"password"===j&&(null===(d=f.current)||void 0===d?void 0:d.value)&&React.createElement("button",{className:cnTextField("ClearButton"),type:"button",onClick:Aa},React.createElement(Ka,{className:cnTextField("Icon"),size:Fa})),Ca&&!la&&"password"!==j&&React.createElement("div",{className:cnTextField("Side",{position:"right",type:Ea?"string":"icon"}),title:"string"==typeof K?K:void 0},Ea?K:React.createElement(Ca,{className:cnTextField("Icon"),size:Fa}))),_&&React.createElement(FieldCaption,{className:cnTextField("Caption"),status:D||C},_)))};export var TextField=forwardRef(TextFieldRender);export*from"./types";
//# sourceMappingURL=TextField.js.map