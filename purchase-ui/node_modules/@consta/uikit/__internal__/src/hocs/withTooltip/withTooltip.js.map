{"version":3,"file":"withTooltip.js","names":["React","useCallback","useRef","Tooltip","useDebounce","useFlag","useForkRef","useMutableRef","withTooltipPropMode","withTooltipPropModeDefault","appearTimeoutDefault","exitTimeoutDefault","withTooltip","hocProps","Component","forwardRef","props","ref","tooltipProps","componentProps","mode","tooltipContent","content","closeOnClickOutside","appearTimeout","exitTimeout","otherTooltipProps","resultContent","visible","setVisible","acnortRef","hoverStateRef","tooltip","acnor","mutablePropsRef","onMouseEnter","onMouseLeave","onClick","mouseEnterController","current","on","mouseLeaveController","off","acnorOnMouseEnter","e","acnorOnMouseLeave","tooltipOnMouseEnter","tooltipOnMouseLeave","tooltipOnClickOutside","acnorOnClick","toggle","className"],"sources":["../../../../../src/hocs/withTooltip/withTooltip.tsx"],"sourcesContent":["import React, { useCallback, useRef } from 'react';\n\nimport {\n  Tooltip,\n  TooltipProps as TooltipComponentProps,\n} from '##/components/Tooltip';\nimport { useDebounce } from '##/hooks/useDebounce';\nimport { useFlag } from '##/hooks/useFlag';\nimport { useForkRef } from '##/hooks/useForkRef';\nimport { useMutableRef } from '##/hooks/useMutableRef';\n\nexport const withTooltipPropMode = ['mouseover', 'click'] as const;\nexport const withTooltipPropModeDefault = withTooltipPropMode[0];\ntype WithTooltipPropMode = typeof withTooltipPropMode[number];\n\nexport const appearTimeoutDefault = 400;\nexport const exitTimeoutDefault = 200;\n\ntype ComponentProps = {\n  onClick?: React.MouseEventHandler;\n  onMouseEnter?: React.MouseEventHandler;\n  onMouseLeave?: React.MouseEventHandler;\n};\n\nexport type TooltipProps = Omit<TooltipComponentProps, 'children' | 'ref'> & {\n  tooltipContent?: React.ReactNode;\n  /** @deprecated use tooltipContent */\n  content?: React.ReactNode;\n  mode?: WithTooltipPropMode;\n  closeOnClickOutside?: boolean;\n  appearTimeout?: number;\n  exitTimeout?: number;\n};\n\nexport type WithTooltipProps<Props> = Omit<Props, 'tooltipProps'> & {\n  tooltipProps?: TooltipProps;\n};\n\ntype HoverState = {\n  tooltip: boolean;\n  acnor: boolean;\n};\n\nexport function withTooltip(hocProps?: TooltipProps) {\n  return function <COMPONENT_TYPE, COMPONENT_PROPS extends ComponentProps>(\n    Component: COMPONENT_TYPE,\n  ) {\n    return React.forwardRef<HTMLElement, WithTooltipProps<COMPONENT_PROPS>>(\n      (props, ref) => {\n        const { tooltipProps = {}, ...componentProps } = props;\n\n        const {\n          mode = 'mouseover',\n          tooltipContent,\n          content,\n          closeOnClickOutside = true,\n          appearTimeout = appearTimeoutDefault,\n          exitTimeout = exitTimeoutDefault,\n          ...otherTooltipProps\n        } = {\n          ...hocProps,\n          ...tooltipProps,\n        };\n\n        const resultContent = tooltipContent ?? content;\n\n        const [visible, setVisible] = useFlag();\n        const acnortRef = useRef<HTMLElement>(null);\n\n        const hoverStateRef = useRef<HoverState>({\n          tooltip: false,\n          acnor: false,\n        });\n\n        const mutablePropsRef = useMutableRef([\n          componentProps.onMouseEnter,\n          componentProps.onMouseLeave,\n          otherTooltipProps.onMouseEnter,\n          otherTooltipProps.onMouseLeave,\n          componentProps.onClick,\n          mode,\n          closeOnClickOutside,\n        ] as const);\n\n        const mouseEnterController = useDebounce(\n          useCallback(() => {\n            mutablePropsRef.current[5] === 'mouseover' &&\n              (hoverStateRef.current.acnor || hoverStateRef.current.tooltip) &&\n              setVisible.on();\n          }, []),\n          appearTimeout,\n        );\n\n        const mouseLeaveController = useDebounce(\n          useCallback(() => {\n            mutablePropsRef.current[5] === 'mouseover' &&\n              !hoverStateRef.current.acnor &&\n              !hoverStateRef.current.tooltip &&\n              setVisible.off();\n          }, []),\n          exitTimeout,\n        );\n\n        const acnorOnMouseEnter: React.MouseEventHandler<HTMLDivElement> =\n          useCallback((e) => {\n            hoverStateRef.current.acnor = true;\n            mouseEnterController();\n            mutablePropsRef.current[0]?.(e);\n          }, []);\n\n        const acnorOnMouseLeave: React.MouseEventHandler<HTMLDivElement> =\n          useCallback((e) => {\n            hoverStateRef.current.acnor = false;\n            mouseLeaveController();\n            mutablePropsRef.current[1]?.(e);\n          }, []);\n\n        const tooltipOnMouseEnter: React.MouseEventHandler<HTMLDivElement> =\n          useCallback((e) => {\n            hoverStateRef.current.tooltip = true;\n            mouseEnterController();\n            mutablePropsRef.current[2]?.(e);\n          }, []);\n\n        const tooltipOnMouseLeave: React.MouseEventHandler<HTMLDivElement> =\n          useCallback((e) => {\n            hoverStateRef.current.tooltip = false;\n            mouseLeaveController();\n            mutablePropsRef.current[3]?.(e);\n          }, []);\n\n        const tooltipOnClickOutside = useCallback(() => {\n          mutablePropsRef.current[5] === 'click' &&\n            mutablePropsRef.current[6] &&\n            setVisible.off();\n        }, [mode, closeOnClickOutside]);\n\n        const acnorOnClick: React.MouseEventHandler = useCallback((e) => {\n          mutablePropsRef.current[5] === 'click' && setVisible.toggle();\n          mutablePropsRef.current[4]?.(e);\n        }, []);\n\n        const Anchor =\n          Component as unknown as React.ComponentType<COMPONENT_PROPS>;\n\n        return (\n          <>\n            <Anchor\n              {...(componentProps as COMPONENT_PROPS)}\n              onClick={acnorOnClick}\n              onMouseEnter={acnorOnMouseEnter}\n              onMouseLeave={acnorOnMouseLeave}\n              ref={useForkRef([acnortRef, ref])}\n            />\n            <Tooltip\n              {...otherTooltipProps}\n              isOpen={visible && !!resultContent}\n              className={otherTooltipProps.className}\n              anchorRef={acnortRef}\n              onClickOutside={tooltipOnClickOutside}\n              onMouseEnter={tooltipOnMouseEnter}\n              onMouseLeave={tooltipOnMouseLeave}\n            >\n              {resultContent}\n            </Tooltip>\n          </>\n        );\n        // привел к типам, так как прокинутый компонент может иметь джененрики и они потеряются за хоком\n      },\n    ) as unknown as\n      | COMPONENT_TYPE\n      | React.ComponentType<{\n          tooltipProps?: TooltipProps;\n        }>;\n  };\n}\n"],"mappings":"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"}