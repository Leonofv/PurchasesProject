import _defineProperty from"@babel/runtime/helpers/defineProperty";import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function(a){function b(){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){throw a}),f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function(a){function b(){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){h=!0,f=a}),f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}import React,{useEffect,useMemo,useRef,useState}from"react";import{getCountedGroups,getGroups}from"../../utils/getGroups";import{useClickOutside}from"../useClickOutside/useClickOutside";import{useDebounce}from"../useDebounce/useDebounce";import{useKeys}from"../useKeysDepricated/useKeysDepricated";import{usePrevious}from"../usePrevious/usePrevious";import{scrollToIndex,useHoistedState}from"./helpers";var isMultipleParams=function(a){return a.multiple},isNotMultipleParams=function(a){return!a.multiple},actions={setOpen:"setOpen",setSearch:"setSearch",highlightIndex:"highlightIndex"},initialState={searchValue:"",resolvedSearchValue:"",isOpen:!1,highlightedIndex:0,scrollToHighlighted:!1};export var isOptionForCreate=function(a){return a&&Object.prototype.hasOwnProperty.call(a,"__optionForCreate")};export var isOptionForSelectAll=function(a){return a&&Object.prototype.hasOwnProperty.call(a,"__optionSelctAll")};export function useSelect(a){var b=a.items,c=a.dropdownRef,d=a.controlRef,e=a.disabled,f=void 0!==e&&e,g=a.multiple,h=void 0!==g&&g,i=a.getItemLabel,j=a.getItemKey,k=a.searchFunction,l=a.getItemGroupKey,m=a.groups,n=a.selectAll,o=void 0!==n&&n,p=a.getGroupKey,q=a.sortGroups,r=a.getItemDisabled,s=a.onFocus,t=a.onBlur,u=a.searchValue,v=a.withoutClearSearch,w=useRef(null),x=useState(!1),y=_slicedToArray(x,2),z=y[0],A=y[1],B=a.value&&(Array.isArray(a.value)?a.value:[a.value])||[],C=useHoistedState(initialState),D=_slicedToArray(C,2),E=D[0],F=E.searchValue,G=E.isOpen,H=E.highlightedIndex,I=E.resolvedSearchValue,J=E.scrollToHighlighted,K=D[1],L=function(a,b){return-1!==i(a).toLocaleLowerCase().indexOf(b.toLocaleLowerCase())},M=React.useMemo(function(){if(I&&""!==I){var c=b.filter(function(a){return k?k(a,I):L(a,I)}),d=!!b.find(function(a){return i(a).toString().toLowerCase()===I.toLocaleLowerCase()});return[c,a.onCreate&&!d?{label:F,__optionForCreate:!0}:void 0]}return[b,void 0]},[b,I]),N=_slicedToArray(M,2),O=N[0],P=N[1],Q=useMemo(function(){var b=getCountedGroups(getGroups(O,null!==m&&void 0!==m&&m.length?l:void 0,m,p,q),isMultipleParams(a)?a.value:[],o,j,r);return P?[P].concat(_toConsumableArray(b)):b},[B,o,O,m,l,r,p,q,P]),R=useMemo(function(){var b=!1;return 0<F.length&&(b=0===Q.filter(function(a){return isOptionForCreate(a)||0<a.items.length||a.group}).length&&!a.onCreate),b},[Q]),S=0!==b.length,T=function(){var a=0;if(0<B.length){var b,c=_createForOfIteratorHelper(Q);try{for(c.s();!(b=c.n()).done;){var f=b.value;if(isOptionForCreate(f)){a++;continue}var d,e=_createForOfIteratorHelper(f.items);try{for(e.s();!(d=e.n()).done;){var g=d.value;if(isOptionForSelectAll(g))return a;if(j(g)===j(B[0]))return a;a++}}catch(a){e.e(a)}finally{e.f()}}}catch(a){c.e(a)}finally{c.f()}}return 0},U=React.useCallback(function(a){K(function(b){return _objectSpread(_objectSpread({},b),{},{isOpen:a})},actions.setOpen)},[K]),V=useDebounce(function(a){K(function(b){return _objectSpread(_objectSpread({},b),{},{resolvedSearchValue:a})},actions.setSearch)},300),W=React.useCallback(function(a){K(function(b){return _objectSpread(_objectSpread({},b),{},{searchValue:a||""})},actions.setSearch),V(a||"")},[K,V]),X=usePrevious(G);React.useLayoutEffect(function(){if(null!==B&&!X&&G){var a=T();0<O.length&&scrollToIndex(a,c)}});var Y=React.useCallback(function(a,b){K(function(c){return _objectSpread(_objectSpread({},c),{},{highlightedIndex:Math.min(Math.max(0,"function"==typeof a?a(c.highlightedIndex):a),P?O.length:O.length-1),scrollToHighlighted:b})},actions.highlightIndex)},[O,K,P]),Z=function(b,c){if(b.stopPropagation(),isMultipleParams(a)){var d,e=null===(d=a.value)||void 0===d?void 0:d.filter(function(a){return j(a)!==j(c)});a.onChange({e:b,value:null!==e&&void 0!==e&&e.length?e:null})}},$=function(b,c){if(!(r&&r(c))){if(isMultipleParams(a)){var d=B.some(function(a){return j(a)===j(c)})?B.filter(function(a){return j(a)!==j(c)}):[].concat(_toConsumableArray(B),[c]);a.onChange({value:d.length?d:null,e:b})}isNotMultipleParams(a)&&(a.onChange({value:c,e:b}),U(!1)),v||W("")}},_=function(b){var c=b.e,d=b.items;if(isMultipleParams(a)){var e=r?d.filter(function(a){return!r(a)}):d,f=[],g=[];B.forEach(function(a){e.find(function(b){return j(a)===j(b)})?f.push(a):g.push(a)}),f.length===e.length?a.onChange({value:g,e:c}):a.onChange({e:c,value:[].concat(g,_toConsumableArray(e))})}},aa=function(b,c){a.onCreate&&a.onCreate({e:b,label:c}),U(!1),v||W("")},ba=function(b){if(v||W(""),isMultipleParams(a)){var c=null===B||void 0===B?void 0:B.filter(function(a){return null===r||void 0===r?void 0:r(a)});a.onChange({value:c&&0<c.length?c:null,e:b})}isNotMultipleParams(a)&&a.onChange({value:null,e:b})},ca=function(a,b){b.preventDefault(),f||U(!0),Y(function(a){return a-1},!0)},da=function(a,b){b.preventDefault(),f||U(!0),Y(function(a){return a+1},!0)},ea=useKeys({ArrowUp:ca,ArrowDown:da,PageUp:ca,PageDown:da,Home:ca,End:da,Enter:function Enter(a,b){if(G){(F||O[H])&&b.preventDefault();var c=function(a){var b,c=0,d=_createForOfIteratorHelper(Q);try{for(d.s();!(b=d.n()).done;){var e=b.value;if(isOptionForCreate(e))return c++,[void 0,e];if(e.items.length+c>a)return[e,e.items[a-c]];c+=e.items.length}}catch(a){d.e(a)}finally{d.f()}return[void 0,void 0]},d=c(H),e=_slicedToArray(d,2),f=e[0],g=e[1];if(isOptionForCreate(g))return void aa(b,g.label);if(isOptionForSelectAll(g)){var h;return void _({e:b,items:null!==(h=null===f||void 0===f?void 0:f.items.filter(function(a){return!isOptionForSelectAll(a)}))&&void 0!==h?h:[]})}g&&$(b,g)}},Escape:function Escape(){U(!1)},Tab:function Tab(){U(!1)},Backspace:function Backspace(a,b){F||(h?Z(b,B[B.length-1]):ba(b))}});useClickOutside({isActive:G,ignoreClicksInsideRefs:[c,d],handler:function handler(){U(!1)}}),React.useEffect(function(){f&&U(!1)},[f]),React.useEffect(function(){var a=T();Y(a,!0)},[Y]),React.useEffect(function(){0<O.length&&J&&scrollToIndex(H,c)},[H]);return useEffect(function(){W(u)},[u]),{isOpen:G,isFocused:z,highlightedIndex:H,visibleItems:Q,highlightIndex:Y,getOptionProps:function getOptionProps(a){var b=a.index,c=a.item;if(isOptionForCreate(c))return{onClick:function onClick(a){aa(a,c.label)},onMouseEnter:function onMouseEnter(){Y(b,!1)},active:!1,hovered:b===H,key:"__optionForCreate"};if(isOptionForSelectAll(c)){var f=function(){var a,b=_createForOfIteratorHelper(Q);try{for(b.s();!(a=b.n()).done;){var e=a.value;if(isOptionForCreate(e))break;if(e.key===c.groupKey){var d;return null!==(d=null===e||void 0===e?void 0:e.items.filter(function(a){return!isOptionForSelectAll(a)}))&&void 0!==d?d:[]}}}catch(a){b.e(a)}finally{b.f()}return[]};return{onClick:function onClick(a){_({e:a,items:f()})},onMouseEnter:function onMouseEnter(){Y(b,!1)},active:!1,hovered:b===H,key:"__optionForSelectAll"}}var d=j(c);return{onClick:function onClick(a){$(a,c)},onMouseEnter:function onMouseEnter(){Y(b,!1)},active:!!B.find(function(a){return j(a)===d}),hovered:b===H,key:d}},handleInputFocus:function handleInputFocus(a){f||(!z&&A(!0),"function"==typeof s&&s(a))},handleInputBlur:function handleInputBlur(a){if(G){var b;return void(null===(b=w.current)||void 0===b?void 0:b.focus())}z&&A(!1),"function"==typeof t&&t(a)},handleToggleDropdown:function handleToggleDropdown(){if(G)U(!1),A(!1);else{var a;U(!0),A(!0),null===(a=w.current)||void 0===a?void 0:a.focus()}},handleInputClick:function handleInputClick(){if(f||U(!G),h){var a;null===(a=w.current)||void 0===a?void 0:a.focus()}},inputRef:w,getKeyProps:ea,handleInputChange:function handleInputChange(a){f||!h&&0<B.length||(W(a.target.value),U(!0))},searchValue:F,clearValue:ba,getHandleRemoveValue:function getHandleRemoveValue(a){return function(b){return Z(b,a)}},notFound:R,hasItems:S}}
//# sourceMappingURL=useSelect.js.map