{"version":3,"file":"useVirtualScroll.js","names":["useEffect","useMemo","useRef","useState","useMutableRef","useRefs","useResizeObserved","arraysIsEq","calculateBounds","calculateSavedSizes","defaultItemsCalculationCount","getElementHeight","useCalculateVisiblePosition","useScroll","useVirtualScroll","length","onScrollToBottom","isActive","visiblePosition","setVisiblePosition","bounds","setBounds","listRefs","scrollElementRef","sizes","savedSizesRef","onScrollToBottomRef","scrollElementRefHeight","calculateVisiblePosition","current","resetVisiblePosition","resetBounds","state","slice","spaceTop"],"sources":["../../../../../src/hooks/useVirtualScroll/useVirtualScroll.ts"],"sourcesContent":["import { useEffect, useMemo, useRef, useState } from 'react';\n\nimport { useMutableRef } from '##/hooks/useMutableRef';\nimport { useRefs } from '##/hooks/useRefs';\nimport { useResizeObserved } from '##/hooks/useResizeObserved';\n\nimport {\n  arraysIsEq,\n  Bounds,\n  calculateBounds,\n  calculateSavedSizes,\n  defaultItemsCalculationCount,\n  getElementHeight,\n  useCalculateVisiblePosition,\n  useScroll,\n  UseVirtualScrollProps,\n  UseVirtualScrollReturn,\n} from './hellpers';\n\nexport const useVirtualScroll = <\n  ITEM_ELEMENT extends HTMLElement = HTMLDivElement,\n  SCROLL_ELEMENT extends HTMLElement = HTMLDivElement,\n>({\n  length,\n  onScrollToBottom,\n  isActive = false,\n}: UseVirtualScrollProps): UseVirtualScrollReturn<\n  ITEM_ELEMENT,\n  SCROLL_ELEMENT\n> => {\n  const [visiblePosition, setVisiblePosition] = useState<[number, number]>([\n    0, 0,\n  ]);\n  const [bounds, setBounds] = useState<Bounds>([\n    [0, 0],\n    [0, isActive ? defaultItemsCalculationCount : length],\n  ]);\n  const listRefs = useRefs<ITEM_ELEMENT>(length, visiblePosition);\n  const scrollElementRef = useRef<SCROLL_ELEMENT>(null);\n  const sizes = useResizeObserved(listRefs, getElementHeight);\n  const savedSizesRef = useRef(calculateSavedSizes([], sizes));\n  const onScrollToBottomRef = useMutableRef(onScrollToBottom);\n  const [scrollElementRefHeight] = useResizeObserved(\n    useMemo(() => {\n      return [scrollElementRef];\n    }, [scrollElementRef]),\n    getElementHeight,\n  );\n  const calculateVisiblePosition = useCalculateVisiblePosition(\n    scrollElementRef.current,\n    setVisiblePosition,\n    sizes,\n  );\n\n  useScroll(scrollElementRef, calculateVisiblePosition, isActive);\n\n  useEffect(() => {\n    if (isActive) {\n      calculateVisiblePosition();\n    }\n  }, [scrollElementRefHeight, isActive]);\n\n  useEffect(() => {\n    if (isActive) {\n      savedSizesRef.current = calculateSavedSizes(savedSizesRef.current, sizes);\n      setBounds(\n        calculateBounds(savedSizesRef.current, sizes, visiblePosition, length),\n      );\n    } else {\n      setBounds([\n        [0, 0],\n        [0, length],\n      ]);\n    }\n  }, [...visiblePosition, sizes, length, isActive]);\n\n  useEffect(() => {\n    if (isActive && onScrollToBottomRef.current && bounds[1][1] + 1 >= length) {\n      onScrollToBottomRef.current(length);\n    }\n  }, [bounds[1][1], isActive]);\n\n  useEffect(() => {\n    const resetVisiblePosition: [number, number] = [0, 0];\n    const resetBounds: Bounds = [\n      [0, 0],\n      [0, isActive ? defaultItemsCalculationCount : length],\n    ];\n\n    setBounds((state) =>\n      arraysIsEq(state[0], resetBounds[0]) &&\n      arraysIsEq(state[1], resetBounds[1])\n        ? state\n        : resetBounds,\n    );\n\n    setVisiblePosition((state) =>\n      arraysIsEq(state, resetVisiblePosition) ? state : resetVisiblePosition,\n    );\n  }, [isActive]);\n\n  return {\n    listRefs,\n    scrollElementRef,\n    slice: bounds[1],\n    spaceTop: bounds[0][0],\n  };\n};\n"],"mappings":"0IAAA,OAASA,SAAT,CAAoBC,OAApB,CAA6BC,MAA7B,CAAqCC,QAArC,KAAqD,OAArD,CAEA,OAASC,aAAT,wBACA,OAASC,OAAT,kBACA,OAASC,iBAAT,4BAEA,OACEC,UADF,CAGEC,eAHF,CAIEC,mBAJF,CAKEC,4BALF,CAMEC,gBANF,CAOEC,2BAPF,CAQEC,SARF,kBAaA,MAAO,IAAMC,iBAAgB,CAAG,WAU3B,IANHC,EAMG,GANHA,MAMG,CALHC,CAKG,GALHA,gBAKG,KAJHC,QAIG,CAJHA,CAIG,iBAC2Cd,QAAQ,CAAmB,CACvE,CADuE,CACpE,CADoE,CAAnB,CADnD,uBACIe,CADJ,MACqBC,CADrB,QAIyBhB,QAAQ,CAAS,CAC3C,CAAC,CAAD,CAAI,CAAJ,CAD2C,CAE3C,CAAC,CAAD,CAAIc,CAAQ,CAAGP,4BAAH,CAAkCK,CAA9C,CAF2C,CAAT,CAJjC,uBAIIK,CAJJ,MAIYC,CAJZ,MAQGC,CAAQ,CAAGjB,OAAO,CAAeU,CAAf,CAAuBG,CAAvB,CARrB,CASGK,CAAgB,CAAGrB,MAAM,CAAiB,IAAjB,CAT5B,CAUGsB,CAAK,CAAGlB,iBAAiB,CAACgB,CAAD,CAAWX,gBAAX,CAV5B,CAWGc,CAAa,CAAGvB,MAAM,CAACO,mBAAmB,CAAC,EAAD,CAAKe,CAAL,CAApB,CAXzB,CAYGE,CAAmB,CAAGtB,aAAa,CAACY,CAAD,CAZtC,GAa8BV,iBAAiB,CAChDL,OAAO,CAAC,UAAM,CACZ,MAAO,CAACsB,CAAD,CACR,CAFM,CAEJ,CAACA,CAAD,CAFI,CADyC,CAIhDZ,gBAJgD,CAb/C,uBAaIgB,CAbJ,MAmBGC,CAAwB,CAAGhB,2BAA2B,CAC1DW,CAAgB,CAACM,OADyC,CAE1DV,CAF0D,CAG1DK,CAH0D,CAnBzD,CAwEH,MA/CAX,UAAS,CAACU,CAAD,CAAmBK,CAAnB,CAA6CX,CAA7C,CA+CT,CA7CAjB,SAAS,CAAC,UAAM,CACViB,CADU,EAEZW,CAAwB,EAE3B,CAJQ,CAIN,CAACD,CAAD,CAAyBV,CAAzB,CAJM,CA6CT,CAvCAjB,SAAS,CAAC,UAAM,CACViB,CADU,EAEZQ,CAAa,CAACI,OAAd,CAAwBpB,mBAAmB,CAACgB,CAAa,CAACI,OAAf,CAAwBL,CAAxB,CAF/B,CAGZH,CAAS,CACPb,eAAe,CAACiB,CAAa,CAACI,OAAf,CAAwBL,CAAxB,CAA+BN,CAA/B,CAAgDH,CAAhD,CADR,CAHG,EAOZM,CAAS,CAAC,CACR,CAAC,CAAD,CAAI,CAAJ,CADQ,CAER,CAAC,CAAD,CAAIN,CAAJ,CAFQ,CAAD,CAKZ,CAZQ,8BAYFG,CAZE,GAYeM,CAZf,CAYsBT,CAZtB,CAY8BE,CAZ9B,GAuCT,CAzBAjB,SAAS,CAAC,UAAM,CACViB,CAAQ,EAAIS,CAAmB,CAACG,OAAhC,EAA2CT,CAAM,CAAC,CAAD,CAAN,CAAU,CAAV,EAAe,CAAf,EAAoBL,CADrD,EAEZW,CAAmB,CAACG,OAApB,CAA4Bd,CAA5B,CAEH,CAJQ,CAIN,CAACK,CAAM,CAAC,CAAD,CAAN,CAAU,CAAV,CAAD,CAAeH,CAAf,CAJM,CAyBT,CAnBAjB,SAAS,CAAC,UAAM,IACR8B,EAAsC,CAAG,CAAC,CAAD,CAAI,CAAJ,CADjC,CAERC,CAAmB,CAAG,CAC1B,CAAC,CAAD,CAAI,CAAJ,CAD0B,CAE1B,CAAC,CAAD,CAAId,CAAQ,CAAGP,4BAAH,CAAkCK,CAA9C,CAF0B,CAFd,CAOdM,CAAS,CAAC,SAACW,CAAD,QACRzB,WAAU,CAACyB,CAAK,CAAC,CAAD,CAAN,CAAWD,CAAW,CAAC,CAAD,CAAtB,CAAV,EACAxB,UAAU,CAACyB,CAAK,CAAC,CAAD,CAAN,CAAWD,CAAW,CAAC,CAAD,CAAtB,CADV,CAEIC,CAFJ,CAGID,CAJI,CAAD,CAPK,CAcdZ,CAAkB,CAAC,SAACa,CAAD,QACjBzB,WAAU,CAACyB,CAAD,CAAQF,CAAR,CAAV,CAA0CE,CAA1C,CAAkDF,CADjC,CAAD,CAGnB,CAjBQ,CAiBN,CAACb,CAAD,CAjBM,CAmBT,CAAO,CACLK,QAAQ,CAARA,CADK,CAELC,gBAAgB,CAAhBA,CAFK,CAGLU,KAAK,CAAEb,CAAM,CAAC,CAAD,CAHR,CAILc,QAAQ,CAAEd,CAAM,CAAC,CAAD,CAAN,CAAU,CAAV,CAJL,CAMR,CAxFM"}